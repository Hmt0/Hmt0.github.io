<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>hmtçš„åšå®¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="hmtçš„åšå®¢">
<meta property="og:url" content="http://hemengting.xyz/index.html">
<meta property="og:site_name" content="hmtçš„åšå®¢">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="He Mengting">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="hmtçš„åšå®¢" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">hmtçš„åšå®¢</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://hemengting.xyz"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-ä»0å¼€å§‹å®ç°ä¸€ä¸ªReactä¸‹" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/20/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAReact%E4%B8%8B/" class="article-date">
  <time class="dt-published" datetime="2021-10-20T15:00:10.000Z" itemprop="datePublished">2021-10-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/20/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAReact%E4%B8%8B/">ä»0å¼€å§‹å®ç°ä¸€ä¸ªReactä¸‹</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>ä¹¦æ¥ä¸Šå›ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†<code>createElement</code>å‡½æ•°ã€<code>render</code>å‡½æ•°å’ŒFibersï¼Œæ¥ä¸‹æ¥å°±è¦å¼€å§‹å¤„ç†ç»„ä»¶æ›´æ–°çš„éƒ¨åˆ†äº†~</p>
<h2 id="5-Renderå’ŒCommité˜¶æ®µ"><a href="#5-Renderå’ŒCommité˜¶æ®µ" class="headerlink" title="5.Renderå’ŒCommité˜¶æ®µ"></a>5.<code>Render</code>å’Œ<code>Commit</code>é˜¶æ®µ</h2><p>ä½†åœ¨è¿™ä¹‹å‰ï¼ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰æ³¨æ„åˆ°ä¸€ä¸ªé—®é¢˜ï¼šæ¯æ¬¡æˆ‘ä»¬å¤„ç†ä¸€ä¸ªå…ƒç´ æ—¶éƒ½ä¼šåœ¨DOM ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ã€‚è€Œä¸”ï¼Œæµè§ˆå™¨è¿˜ä¼šåœ¨å®Œæˆæ•´æ£µæ ‘çš„æ¸²æŸ“ä¹‹å‰æ‰“æ–­æˆ‘ä»¬çš„å·¥ä½œã€‚è¿™æ ·ï¼Œç”¨æˆ·å°†ä¼šçœ‹åˆ°ä¸€ä¸ªä¸å®Œæ•´çš„UIï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸å¸Œæœ›çš„ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬æŠŠrenderå‡½æ•°ä¸­çš„è¿™ä¸€éƒ¨åˆ†ç§»é™¤æ‰ï¼Œè€Œå»è·Ÿè¸ªfiberæ ‘çš„æ ¹èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å«å®ƒâ€œæ­£åœ¨è¿›è¡Œçš„å·¥ä½œâ€rootæˆ–è€…<code>wipRoot</code>ã€‚</p>
<p>å½“æˆ‘ä»¬å®Œæˆäº†æ‰€æœ‰ä»»åŠ¡ï¼ˆä¹Ÿå°±æ˜¯ä»»åŠ¡ä¸­æ²¡æœ‰ä¸‹ä¸€ä¸ªå•å…ƒçš„æ—¶å€™ï¼‰ï¼Œæˆ‘ä»¬å°±æŠŠæ•´ä¸ªfiberæ ‘æäº¤åˆ°DOMä¸­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">commitRoot</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// TODO add nodes to dom</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">element, container</span>) </span>&#123;</span><br><span class="line">  wipRoot = &#123;</span><br><span class="line">    <span class="attr">dom</span>: container,</span><br><span class="line">    <span class="attr">props</span>: &#123;</span><br><span class="line">      <span class="attr">children</span>: [element],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">  nextUnitOfWork = wipRoot</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> nextUnitOfWork = <span class="literal">null</span></span><br><span class="line"><span class="keyword">let</span> wipRoot = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">workLoop</span>(<span class="params">deadline</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> shouldYield = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">while</span> (nextUnitOfWork &amp;&amp; !shouldYield) &#123;</span><br><span class="line">    nextUnitOfWork = performUnitOfWork(</span><br><span class="line">      nextUnitOfWork</span><br><span class="line">    )</span><br><span class="line">    shouldYield = deadline.timeRemaining() &lt; <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!nextUnitOfWork &amp;&amp; wipRoot) &#123;</span><br><span class="line">    commitRoot()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  requestIdleCallback(workLoop)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åœ¨<code>commitRoot</code>å‡½æ•°ä¸­å®Œæˆtæäº¤ã€‚è¿™é‡Œæˆ‘ä»¬é€’å½’åœ°å°†æ‰€æœ‰èŠ‚ç‚¹æ·»åŠ åˆ°DOMä¸­ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">commitRoot</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  commitWork(wipRoot.child)</span><br><span class="line">  wipRoot = <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">commitWork</span>(<span class="params">fiber</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!fiber) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> domParent = fiber.parent.dom</span><br><span class="line">  domParent.appendChild(fiber.dom)</span><br><span class="line">  commitWork(fiber.child)</span><br><span class="line">  commitWork(fiber.sibling)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ï¼ˆä¹Ÿå°±æ˜¯æŠŠå»ºæ ‘è¿‡ç¨‹æ”¾åœ¨renderï¼Œæ’å…¥æ”¾åœ¨commitï¼Ÿï¼‰</p>
<h2 id="6-åè°ƒ"><a href="#6-åè°ƒ" class="headerlink" title="6.åè°ƒ"></a>6.åè°ƒ</h2><p>å¸¦ç›®å‰ä¸ºæ­¢æˆ‘ä»¬åªæ˜¯åœ¨DOMä¸­æ·»åŠ ä¸œè¥¿ï¼Œæ€ä¹ˆå»æ›´æ–°æˆ–è€…åˆ é™¤èŠ‚ç‚¹å‘¢ï¼Ÿ</p>
<p>è¿™å°±æ˜¯æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦åšçš„ï¼Œæˆ‘ä»¬éœ€è¦å°†åœ¨<code>render</code>å‡½æ•°ä¸Šæ¥æ”¶åˆ°çš„å…ƒç´ ä¸æäº¤ç»™DOMçš„æœ€åä¸€ä¸ªfiberæ ‘è¿›è¡Œæ¯”è¾ƒã€‚</p>
<p>æ‰€ä»¥å®Œæˆæäº¤åï¼Œæˆ‘ä»¬éœ€è¦ä¿å­˜â€œä¸Šä¸€ä¸ªæäº¤åˆ°DOMçš„fiberæ ‘â€çš„å¼•ç”¨ã€‚æˆ‘ä»¬ç§°å®ƒä¸º<code>currentRoot</code>ã€‚</p>
<p>æˆ‘ä»¬è¿˜è¦ä¸ºæ¯ä¸€ä¸ªfiberæ·»åŠ ä¸€ä¸ª<code>alternate</code>å±æ€§ã€‚è¿™ä¸ªå±æ€§æ˜¯åˆ°åˆ°æ—§fiberçš„é“¾æ¥ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ä¸Šä¸€æ¬¡æäº¤é˜¶æ®µå•Šä¸­æåˆ°åˆ°DOMä¸­çš„fiberã€‚</p>
<p>ç°åœ¨è®©æˆ‘ä»¬ä»<code>performUnitOfWork</code>ä¸­æå–åˆ›å»ºæ–°fibersçš„ä»£ç ï¼Œæ”¾åœ¨ä¸€ä¸ªæ–°çš„<code>reconcileChilren</code>å‡½æ•°ä¸­ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬æŠŠæ—§fiberså’Œæ–°å…ƒç´ è°ƒå’Œèµ·æ¥ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reconcileChildren</span>(<span class="params">wipFiber, elements</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line">  <span class="keyword">let</span> oldFiber =</span><br><span class="line">    wipFiber.alternate &amp;&amp; wipFiber.alternate.child</span><br><span class="line">  <span class="keyword">let</span> prevSibling = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (</span><br><span class="line">    index &lt; elements.length ||</span><br><span class="line">    oldFiber != <span class="literal">null</span></span><br><span class="line">  ) &#123;</span><br><span class="line">    <span class="keyword">const</span> element = elements[index]</span><br><span class="line">    <span class="keyword">let</span> newFiber = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO compare oldFiber to element</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬åŒæ—¶è¿­ä»£æ—§fiberçš„å­©å­ï¼ˆ<code>wipFiber.alternate</code>ï¼‰å’Œæˆ‘ä»¬æƒ³è°ƒå’Œçš„å…ƒç´ æ•°ç»„ã€‚</p>
<p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œå¦‚æœå¿½ç•¥åŒæ—¶éå†ä¸€ä¸ªæ•°ç»„å’Œé“¾è¡¨çš„æ¨¡æ¿ä»£ç ï¼Œåœ¨whileå¾ªç¯ä¸­åªå‰©ä¸‹æœ€é‡è¦çš„éƒ¨åˆ†ï¼š<code>olfFiber</code>å’Œ<code>element</code>ã€‚**<code>element</code>æ˜¯æˆ‘ä»¬æƒ³æ¸²æŸ“åœ¨DOMä¸­çš„ä¸œè¥¿ï¼Œ<code>oldFiber</code>åˆ™æ˜¯æˆ‘ä»¬ä¸Šæ¬¡çš„æ¸²æŸ“çš„å†…å®¹ã€‚**</p>
<p>æˆ‘ä»¬éœ€è¦æ¯”è¾ƒå®ƒä»¬ï¼Œæ¥çœ‹çœ‹æ˜¯ä¸æ˜¯æœ‰éœ€è¦åº”ç”¨åœ¨DOMä¸­çš„æ›´æ”¹ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sameType =</span><br><span class="line">    oldFiber &amp;&amp;</span><br><span class="line">    element &amp;&amp;</span><br><span class="line">    element.type == oldFiber.type</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (sameType) &#123;</span><br><span class="line">    <span class="comment">// TODO update the node</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (element &amp;&amp; !sameType) &#123;</span><br><span class="line">    <span class="comment">// TODO add this node</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (oldFiber &amp;&amp; !sameType) &#123;</span><br><span class="line">    <span class="comment">// TODO delete the oldFiber&#x27;s node</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä½¿ç”¨ç±»å‹æ¥æ¯”è¾ƒå®ƒä»¬ï¼š</p>
<ul>
<li>å¦‚æœæ—§fiberå’Œæ–°å…ƒç´ ç±»å‹ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä¿ç•™DOMèŠ‚ç‚¹å¹¶ä¸”åªæ›´æ–°çš„å±æ€§</li>
<li>å¦‚æœç±»å‹ä¸åŒï¼Œå¹¶ä¸”å­˜åœ¨æ–°å…ƒç´ ï¼Œæ„å‘³ç€æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„DOMèŠ‚ç‚¹</li>
<li>å¦‚æœç±»å‹ä¸åŒï¼Œå¹¶ä¸”å­˜åœ¨æ—§fiberï¼Œæˆ‘ä»¬éœ€è¦ç§»é™¤æ—§èŠ‚ç‚¹</li>
</ul>
<p>åœ¨è¿™é‡ŒReactè¿˜ç”¨äº†keysï¼Œæ¥å®ç°æ›´é«˜æ•ˆçš„è°ƒå’Œã€‚æ¯”å¦‚ï¼Œå®ƒæ£€æµ‹å­å…ƒç´ åœ¨å…ƒç´ æ•°ç»„ä¸­çš„ä½ç½®ä½•æ—¶æ”¹å˜ã€‚</p>
<p>å½“æ—§fiberå’Œå…ƒç´ æœ‰ç›¸åŒçš„ç±»å‹æ—¶ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°fiberï¼Œä½¿DOMèŠ‚ç‚¹å’Œæ—§fiberä¿æŒä¸€è‡´ï¼Œå±æ€§å’Œå…ƒç´ ä¿æŒä¸€è‡´ã€‚</p>
<p>æˆ‘ä»¬è¿˜ç»™fiberæ·»åŠ äº†ä¸€ä¸ªæ–°çš„å±æ€§ï¼š<code>effectTag</code>ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åœ¨æäº¤é˜¶æ®µä½¿ç”¨è¿™ä¸ªå±æ€§ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sameType =</span><br><span class="line">      oldFiber &amp;&amp;</span><br><span class="line">      element &amp;&amp;</span><br><span class="line">      element.type == oldFiber.type</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (sameType) &#123;</span><br><span class="line">      newFiber = &#123;</span><br><span class="line">        <span class="attr">type</span>: oldFiber.type,</span><br><span class="line">        <span class="attr">props</span>: element.props,</span><br><span class="line">        <span class="attr">dom</span>: oldFiber.dom,</span><br><span class="line">        <span class="attr">parent</span>: wipFiber,</span><br><span class="line">        <span class="attr">alternate</span>: oldFiber,</span><br><span class="line">        <span class="attr">effectTag</span>: <span class="string">&quot;UPDATE&quot;</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºéœ€è¦ä¸€ä¸ªæ–°çš„DOMèŠ‚ç‚¹çš„å…ƒç´ ï¼Œæˆ‘ä»¬ç”¨<code>PLACEMENT</code>æ¥æ ‡è®°æ–°fiberï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (element &amp;&amp; !sameType) &#123;</span><br><span class="line">      newFiber = &#123;</span><br><span class="line">        <span class="attr">type</span>: element.type,</span><br><span class="line">        <span class="attr">props</span>: element.props,</span><br><span class="line">        <span class="attr">dom</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">parent</span>: wipFiber,</span><br><span class="line">        <span class="attr">alternate</span>: <span class="literal">null</span>,</span><br><span class="line">        <span class="attr">effectTag</span>: <span class="string">&quot;PLACEMENT&quot;</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºéœ€è¦åˆ é™¤èŠ‚ç‚¹çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¸éœ€è¦æ–°fiberï¼Œåªè¦åœ¨æ—§fiberä¸Šæ·»åŠ effect tagå°±å¥½äº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (oldFiber &amp;&amp; !sameType) &#123;</span><br><span class="line">     oldFiber.effectTag = <span class="string">&quot;DELETION&quot;</span></span><br><span class="line">     deletions.push(oldFiber)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯å½“æˆ‘ä»¬æŠŠfiberæ ‘æäº¤åˆ°DOMæ—¶ï¼Œæˆ‘ä»¬ä»â€œæ­£åœ¨å·¥ä½œä¸­çš„â€æ ¹æ‰§è¡Œï¼Œå®ƒå¹¶æ²¡æœ‰æ—§fiberså‘€ã€‚</p>
<p>å› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ•°ç»„deletionsæ¥è·Ÿè¸ªæƒ³è¦ç§»é™¤çš„èŠ‚ç‚¹ã€‚æ¥ç€ï¼Œå½“æˆ‘ä»¬å‘DOMæäº¤æ›´æ”¹æ—¶ï¼Œæˆ‘ä»¬ä»ç„¶ä½¿ç”¨deletionsæ•°ç»„ä¸­çš„fibersï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">commitRoot</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  deletions.forEach(commitWork)</span><br><span class="line">  commitWork(wipRoot.child)</span><br><span class="line">  currentRoot = wipRoot</span><br><span class="line">  wipRoot = <span class="literal">null</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä¿®æ”¹<code>commitWork</code>å‡½æ•°æ¥å¤„ç†æ–°çš„<code>effectTags</code>ã€‚</p>
<p>å¦‚æœfiberçš„effect tagå€¼æ˜¯<code>PLACEMENT</code>ï¼Œæˆ‘ä»¬å’Œä¹‹å‰åšçš„ä¸€æ ·ï¼ŒæŠŠDOMèŠ‚ç‚¹è¿½åŠ åˆ°çˆ¶fiberçš„èŠ‚ç‚¹ä¸Šï¼›</p>
<p>å¦‚æœæ˜¯<code>DELETION</code>,åˆ™ç›¸åï¼Œæˆ‘ä»¬è¦åˆ é™¤å­èŠ‚ç‚¹ï¼›</p>
<p>å¦‚æœæ˜¯<code>UPDATE</code>ï¼Œæˆ‘ä»¬éœ€è¦ç”¨æ›´æ”¹åçš„å±æ€§æ›´æ–°ç°å­˜çš„DOMèŠ‚ç‚¹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">commitWork</span>(<span class="params">fiber</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!fiber) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> domParent = fiber.parent.dom</span><br><span class="line">   <span class="keyword">if</span> (</span><br><span class="line">    fiber.effectTag === <span class="string">&quot;PLACEMENT&quot;</span> &amp;&amp;</span><br><span class="line">    fiber.dom != <span class="literal">null</span></span><br><span class="line">   ) &#123;</span><br><span class="line">       domParent.appendChild(fiber.dom)</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (fiber.effectTag === <span class="string">&quot;DELETION&quot;</span>) &#123;</span><br><span class="line">    domParent.removeChild(fiber.dom)</span><br><span class="line">   &#125; <span class="keyword">else</span> <span class="keyword">if</span> (</span><br><span class="line">    fiber.effectTag === <span class="string">&quot;UPDATE&quot;</span> &amp;&amp;</span><br><span class="line">    fiber.dom != <span class="literal">null</span></span><br><span class="line">   ) &#123;</span><br><span class="line">       updateDom(</span><br><span class="line">           fiber.dom,</span><br><span class="line">           fiber.alternate.props,</span><br><span class="line">           fiber.props</span><br><span class="line">       )</span><br><span class="line">  commitWork(fiber.child)</span><br><span class="line">  commitWork(fiber.sibling)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬éœ€è¦å†™ä¸€ä¸ª<code>updateDom</code>å‡½æ•°ï¼šæˆ‘ä»¬å¯¹æ¯”æ–°æ—§fibersçš„å±æ€§ï¼Œç§»é™¤æ— ç”¨å±æ€§ï¼Œè®¾ç½®æ–°çš„æˆ–æ”¹å˜çš„å±æ€§ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isProperty = <span class="function"><span class="params">key</span> =&gt;</span> key !== <span class="string">&quot;children&quot;</span></span><br><span class="line"><span class="keyword">const</span> isNew = <span class="function">(<span class="params">prev, next</span>) =&gt;</span> <span class="function"><span class="params">key</span> =&gt;</span></span><br><span class="line">  prev[key] !== next[key]</span><br><span class="line"><span class="keyword">const</span> isGone = <span class="function">(<span class="params">prev, next</span>) =&gt;</span> <span class="function"><span class="params">key</span> =&gt;</span> !(key <span class="keyword">in</span> next)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateDom</span>(<span class="params">dom, prevProps, nextProps</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Remove old properties</span></span><br><span class="line">  <span class="built_in">Object</span>.keys(prevProps)</span><br><span class="line">    .filter(isProperty)</span><br><span class="line">    .filter(isGone(prevProps, nextProps))</span><br><span class="line">    .forEach(<span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">      dom[name] = <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Set new or changed properties</span></span><br><span class="line">  <span class="built_in">Object</span>.keys(nextProps)</span><br><span class="line">    .filter(isProperty)</span><br><span class="line">    .filter(isNew(prevProps, nextProps))</span><br><span class="line">    .forEach(<span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">      dom[name] = nextProps[name]</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯¹äºäº‹ä»¶ç›‘å¬å±æ€§æˆ‘ä»¬éœ€è¦åšç‰¹æ®Šå¤„ç†ï¼Œä¹Ÿå°±æ˜¯å±æ€§åä»¥â€œonâ€å‰ç¼€å¼€å¤´çš„å±æ€§ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isEvent = <span class="function"><span class="params">key</span> =&gt;</span> key.startsWith(<span class="string">&quot;on&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> isProperty = <span class="function"><span class="params">key</span> =&gt;</span></span><br><span class="line">  key !== <span class="string">&quot;children&quot;</span> &amp;&amp; !isEvent(key)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœäº‹ä»¶å¤„ç†ç¨‹åºå‘ç”Ÿäº†æ”¹å˜ï¼Œæˆ‘ä»¬æŠŠå®ƒä»èŠ‚ç‚¹ä¸­ç§»é™¤ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Remove old or changed event listeners</span></span><br><span class="line"><span class="built_in">Object</span>.keys(prevProps)</span><br><span class="line">  .filter(isEvent)</span><br><span class="line">  .filter(</span><br><span class="line">    <span class="function"><span class="params">key</span> =&gt;</span></span><br><span class="line">      !(key <span class="keyword">in</span> nextProps) ||</span><br><span class="line">      isNew(prevProps, nextProps)(key)</span><br><span class="line">  )</span><br><span class="line">  .forEach(<span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> eventType = name</span><br><span class="line">      .toLowerCase()</span><br><span class="line">      .substring(<span class="number">2</span>)</span><br><span class="line">    dom.removeEventListener(</span><br><span class="line">      eventType,</span><br><span class="line">      prevProps[name]</span><br><span class="line">    )</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>ç„¶åæ·»åŠ ä¸€ä¸ªæ–°çš„å¤„ç†ç¨‹åºï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Add event listeners</span></span><br><span class="line"> <span class="built_in">Object</span>.keys(nextProps)</span><br><span class="line">   .filter(isEvent)</span><br><span class="line">   .filter(isNew(prevProps, nextProps))</span><br><span class="line">   .forEach(<span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">const</span> eventType = name</span><br><span class="line">       .toLowerCase()</span><br><span class="line">       .substring(<span class="number">2</span>)</span><br><span class="line">     dom.addEventListener(</span><br><span class="line">       eventType,</span><br><span class="line">       nextProps[name]</span><br><span class="line">     )</span><br><span class="line">   &#125;)</span><br></pre></td></tr></table></figure>








































      
    </div>
    <footer class="article-footer">
      <a data-url="http://hemengting.xyz/2021/10/20/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAReact%E4%B8%8B/" data-id="ckuzpu8ls0000joub6lha8n3o" data-title="ä»0å¼€å§‹å®ç°ä¸€ä¸ªReactä¸‹" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react/" rel="tag">react</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ä»0å¼€å§‹å®ç°ä¸€ä¸ªReact" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/17/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAReact/" class="article-date">
  <time class="dt-published" datetime="2021-10-17T04:18:53.000Z" itemprop="datePublished">2021-10-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/17/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAReact/">ä»0å¼€å§‹å®ç°ä¸€ä¸ªReact</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>æœ€è¿‘çœ‹åˆ°ä¸€ç¯‡<a target="_blank" rel="noopener" href="https://pomb.us/build-your-own-react/">æ•™ä½ æ„å»ºä¸€ä¸ªReact</a> çš„æ–‡ç« ï¼Œæ„Ÿè§‰å†™çš„å¾ˆå¥½ï¼Œè€Œä¸”äº¤äº’ä¹Ÿåšå¾—ç‰¹åˆ«æ£’ï¼Œåœ¨æ­¤ç¿»è¯‘è®°å½•ä¸€ä¸‹ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« çš„ä¸»è¦ç›®çš„æ˜¯éµå¾ªReactä»£ç çš„ä½“ç³»ç»“æ„ä¸€æ­¥æ­¥åœ°å†™å‡ºä¸€ä¸ªç®€å•çš„Reactï¼Œä½†æ²¡æœ‰æ‰€æœ‰çš„ä¼˜åŒ–å’Œéå¿…è¦çš„åŠŸèƒ½ã€‚</p>
<p>è¿‡ç¨‹åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>The <code>createElement</code> Function</li>
<li>The <code>render</code> Function</li>
<li>å¹¶å‘æ¨¡å‹</li>
<li>Fibers</li>
<li>æ¸²æŸ“å’Œæäº¤é˜¶æ®µ</li>
<li>åè°ƒ</li>
<li>å‡½æ•°ç»„ä»¶</li>
<li>Hooks</li>
</ol>
<h2 id="1ï¼šå‡†å¤‡"><a href="#1ï¼šå‡†å¤‡" class="headerlink" title="-1ï¼šå‡†å¤‡"></a>-1ï¼šå‡†å¤‡</h2><p>é¦–å…ˆï¼Œ<code>JSX</code>è¯­æ³•æ˜¯é€šè¿‡Babelè½¬æ¢æˆJavaScriptçš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®ä¸­é…ç½®Babelã€‚</p>
<p>å®‰è£…ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev @babel/core @babel/cli @babel/preset-env @babel/preset-react</span><br></pre></td></tr></table></figure>

<p>åœ¨æ ¹ç›®å½•ä¸­æ·»åŠ <code>.babelrc</code>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;presets&quot;</span>: [<span class="string">&quot;@babel/preset-env&quot;</span>, <span class="string">&quot;@babel/preset-react&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>.babel.config.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> presets = [</span><br><span class="line">  [</span><br><span class="line">    <span class="string">&quot;@babel/env&quot;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">targets</span>: &#123;</span><br><span class="line">        <span class="attr">edge</span>: <span class="string">&quot;17&quot;</span>,</span><br><span class="line">        <span class="attr">firefox</span>: <span class="string">&quot;60&quot;</span>,</span><br><span class="line">        <span class="attr">chrome</span>: <span class="string">&quot;67&quot;</span>,</span><br><span class="line">        <span class="attr">safari</span>: <span class="string">&quot;11.1&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">useBuiltIns</span>: <span class="string">&quot;usage&quot;</span>,</span><br><span class="line">      <span class="attr">corejs</span>: <span class="string">&quot;3.6.4&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; presets &#125;;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œ<code>npx src --out-dir lib</code>å°±å¯ä»¥æŠŠè½¬æ¢ç»“æœä¿å­˜åœ¨libæ–‡ä»¶å¤¹ä¸‹é¢äº†~</p>
<h2 id="0ï¼šå›é¡¾"><a href="#0ï¼šå›é¡¾" class="headerlink" title="0ï¼šå›é¡¾"></a>0ï¼šå›é¡¾</h2><p>ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†æ¸²æŸ“ä¸€ä¸ªReactç»„ä»¶çš„è¿‡ç¨‹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> element = <span class="xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">title</span>=<span class="string">&quot;foo&quot;</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span> <span class="comment">// å®šä¹‰Reactç»„ä»¶</span></span><br><span class="line"><span class="keyword">const</span> container = <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>) <span class="comment">// ä»DOMä¸­è·å–ä¸€ä¸ªèŠ‚ç‚¹container</span></span><br><span class="line">ReactDOM.render(element, container) <span class="comment">// æŠŠReactç»„ä»¶æ¸²æŸ“åˆ°container</span></span><br></pre></td></tr></table></figure>

<p>è¦å®ç°ä¸€ä¸ªReactï¼Œé¦–å…ˆè¦çŸ¥é“Reactçš„æ–¹æ³•æ˜¯å¦‚ä½•å®ç°çš„ï¼Œç”¨åŸç”Ÿçš„JavaScriptæ€ä¹ˆå†™ï¼Œå†å»å°è£…æˆæˆ‘ä»¬çš„æ–¹æ³•ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬ä¸ä½¿ç”¨Reactè¯­æ³•æ¥å®ç°ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ã€‚</p>
<ol>
<li><h4 id="å®šä¹‰ç»„ä»¶"><a href="#å®šä¹‰ç»„ä»¶" class="headerlink" title="å®šä¹‰ç»„ä»¶"></a>å®šä¹‰ç»„ä»¶</h4></li>
</ol>
<p>Babelè½¬æ¢<code>JSX</code>çš„è§„åˆ™å°±æ˜¯ç”¨è°ƒç”¨<code>createElement</code>æ›¿æ¢<code>&lt;&gt;</code>å†…éƒ¨çš„ä»£ç ï¼Œå°†<code>tag name</code>ã€<code>props</code>å’Œå­å…ƒç´ ä½œä¸ºå‚æ•°ä¼ é€’ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> element = React.createElement(</span><br><span class="line">  <span class="string">&quot;h1&quot;</span>,</span><br><span class="line">  &#123; <span class="attr">title</span>: <span class="string">&quot;foo&quot;</span> &#125;,</span><br><span class="line">  <span class="string">&quot;Hello&quot;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><code>React.createElement</code>ä¼šå¯¹å‚æ•°åšä¸€äº›éªŒè¯å¹¶è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œé•¿è¿™æ ·ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> element = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;h1&quot;</span>,</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;foo&quot;</span>,</span><br><span class="line">    <span class="attr">children</span>: <span class="string">&quot;Hello&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨è¿™ä¸ªå¯¹è±¡æ›¿æ¢å‡½æ•°è°ƒç”¨ã€‚<code>type</code>å±æ€§æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¡¨æ˜DOMèŠ‚ç‚¹çš„ç±»å‹ï¼Œå°±æ˜¯åœ¨ç”ŸæˆHTMLå…ƒç´ æ—¶å°†è¦ä¼ ç»™<code>document.createElement</code>çš„<code>tagName</code>ã€‚</p>
<p><code>props</code>å±æ€§æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…æ‹¬<code>JSX</code>å±æ€§çš„æ‰€æœ‰é”®å€¼å¯¹ï¼Œè¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å±æ€§ï¼š<code>children</code>ï¼š</p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­<code>children</code>æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½†æ˜¯å®ƒé€šå¸¸æ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªå…ƒç´ çš„æ•°ç»„ã€‚æ‰€ä»¥å…ƒç´ å®æ•°å‹ç»“æ„çš„ã€‚</p>
<ol start="2">
<li><h4 id="æ¸²æŸ“"><a href="#æ¸²æŸ“" class="headerlink" title="æ¸²æŸ“"></a>æ¸²æŸ“</h4></li>
</ol>
<p>ï¼ˆ<code>container</code>æ˜¯ç›´æ¥è°ƒç”¨<code>document.getElementById</code>è·å–çš„ä¸ç”¨ç®¡ã€‚ï¼‰å¦ä¸€ä¸ªæˆ‘ä»¬è¦æ›¿æ¢çš„Reactä»£ç æ˜¯<code>ReactDOM.render</code>çš„è°ƒç”¨ã€‚<code>render</code>æ˜¯Reactä¿®æ”¹DOMçš„åœ°æ–¹ï¼Œå› æ­¤æˆ‘ä»¬è¦åœ¨è¿™é‡Œå®ç°DOMæ›´æ–°ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬ç”¨<code>type</code>å±æ€§åˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹*ï¼Œæœ¬ä¾‹ä¸­æ˜¯<code>h1</code>ã€‚ç„¶åæˆ‘ä»¬æŠŠå…ƒç´ çš„å…ƒç´ çš„å±æ€§åˆ†é…ç»™èŠ‚ç‚¹ï¼Œæœ¬ä¾‹ä¸­æ˜¯titleå±æ€§ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> node = <span class="built_in">document</span>.createElement(element.type)</span><br><span class="line">node[<span class="string">&quot;title&quot;</span>] = element.props.title</span><br></pre></td></tr></table></figure>

<p>*ä¸ºäº†é¿å…æ··æ·†ï¼Œä¸‹æ–‡ä¸­ä½¿ç”¨â€å…ƒç´ â€è¡¨ç¤ºReactå…ƒç´ ï¼Œâ€œèŠ‚ç‚¹â€è¡¨ç¤ºDOMèŠ‚ç‚¹ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬åˆ›å»ºå­èŠ‚ç‚¹ï¼Œæœ¬ä¾‹ä¸­åªæœ‰ä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹ã€‚ä½¿ç”¨<code>textNode</code>è€Œä¸æ˜¯<code>innerText</code>å¯ä»¥è®©æˆ‘ä»¬ç”¨åŒæ ·çš„æ–¹å¼å¤„ç†æ‰€æœ‰å…ƒç´ ï¼ˆæ–¹ä¾¿é€’å½’ï¼‰ã€‚æ³¨æ„æˆ‘ä»¬åƒå¤„ç†<code>h1</code>çš„titleä¸€æ ·ç»™æ–‡æœ¬èŠ‚ç‚¹è®¾ç½®<code>nodeValue</code>ï¼š<code>&#123;nodeValue: &quot;hello&quot;&#125;</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> text = <span class="built_in">document</span>.createTextNode(<span class="string">&quot;&quot;</span>)</span><br><span class="line">text[<span class="string">&quot;nodeValue&quot;</span>] = element.props.children</span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œæˆ‘ä»¬æŠŠ<code>textNode</code>æ·»åŠ åˆ°<code>h1</code>ï¼Œå†æŠŠ<code>h1</code>æ·»åŠ åˆ°<code>container</code>ã€‚</p>
<p>è¿™æ ·æˆ‘ä»¬å°±åœ¨ä¸ä½¿ç”¨Reactçš„æƒ…å†µä¸‹å®ç°äº†åŒæ ·çš„åŠŸèƒ½ã€‚ç½—å—¦äº†è¿™ä¹ˆå¤šï¼Œå®ç°èµ·æ¥è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œç”¨è¿‡Reactçš„åŒå­¦åº”è¯¥éƒ½å¾ˆç†Ÿæ‚‰ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> element = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&quot;h1&quot;</span>,</span><br><span class="line">  <span class="attr">props</span>: &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&quot;foo&quot;</span>,</span><br><span class="line">    <span class="attr">children</span>: <span class="string">&quot;Hello&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> container = <span class="built_in">document</span>.getElementById(<span class="string">&quot;root&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> node = <span class="built_in">document</span>.createElement(element.type)</span><br><span class="line">node[<span class="string">&quot;title&quot;</span>] = element.props.title</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> text = <span class="built_in">document</span>.createTextNode(<span class="string">&quot;&quot;</span>)</span><br><span class="line">text[<span class="string">&quot;nodeValue&quot;</span>] = element.props.children</span><br><span class="line"></span><br><span class="line">node.appendChild(text)</span><br><span class="line">container.appendChild(node)</span><br></pre></td></tr></table></figure>

<h2 id="1ï¼šcreateElementå‡½æ•°"><a href="#1ï¼šcreateElementå‡½æ•°" class="headerlink" title="1ï¼šcreateElementå‡½æ•°"></a>1ï¼š<code>createElement</code>å‡½æ•°</h2><p>ï¼ˆä¸Šä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥å®šä¹‰äº†elementå¯¹è±¡ï¼‰æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±è¯¥çœŸæ­£å®ç°ä¸€ä¸ªè‡ªå·±çš„<code>createElement</code>å‡½æ•°äº†ã€‚é¦–å…ˆæŠŠ<code>JSX</code>è½¬æ¢æˆ<code>JS</code>ç ”ç©¶ä¸€ä¸‹<code>createElement</code>æ˜¯å¦‚ä½•è°ƒç”¨çš„ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> element = React.createElement(</span><br><span class="line">  <span class="string">&quot;div&quot;</span>,</span><br><span class="line">  &#123; <span class="attr">id</span>: <span class="string">&quot;foo&quot;</span> &#125;,</span><br><span class="line">  React.createElement(<span class="string">&quot;a&quot;</span>, <span class="literal">null</span>, <span class="string">&quot;bar&quot;</span>),</span><br><span class="line">  React.createElement(<span class="string">&quot;b&quot;</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>è¿˜è®°å¾—æˆ‘ä»¬ä¸Šä¸€æ­¥ä¸­å®šä¹‰çš„elementå¯¹è±¡å—ï¼Ÿæˆ‘ä»¬çš„å‡½æ•°çš„åŠŸèƒ½åº”è¯¥æ˜¯åˆ›å»ºä¸€ä¸ªå…·æœ‰<code>type</code>å’Œ<code>props</code>å±æ€§çš„å¯¹è±¡ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createElement</span>(<span class="params">type, props, ...children</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    type,</span><br><span class="line">    <span class="attr">props</span>: &#123;</span><br><span class="line">      ...props,</span><br><span class="line">      children,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œä½¿ç”¨äº†å±•å¼€è¿ç®—ç¬¦å¤„ç†<code>props</code>ï¼Œä½¿ç”¨å‰©ä½™å‚æ•°å¤„ç†<code>children</code>ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›<code>children</code>å±æ€§æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚ä¾‹å¦‚ï¼Œ<code>createElement(&quot;div&quot;)</code>è¿”å›</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;div&quot;</span>,</span><br><span class="line">  <span class="string">&quot;props&quot;</span>: &#123; <span class="string">&quot;children&quot;</span>: [] &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>createElement(&quot;div&quot;, null, a)</code>è¿”å›</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;div&quot;</span>,</span><br><span class="line">  <span class="string">&quot;props&quot;</span>: &#123; <span class="string">&quot;children&quot;</span>: [a] &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>createElement(&quot;div&quot;, null, a, b)</code>è¿”å›</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>: <span class="string">&quot;div&quot;</span>,</span><br><span class="line">  <span class="string">&quot;props&quot;</span>: &#123; <span class="string">&quot;children&quot;</span>: [a, b] &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>children</code>æ•°ç»„æˆ–è®¸åŒ…å«å­—ç¬¦ä¸²æˆ–æ•°å­—è¿™æ ·çš„åŸå§‹å€¼ï¼ˆæ ‘ä¸­çš„å¶å­èŠ‚ç‚¹ï¼‰ã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥åŒ…è£…ä¸æ˜¯å¯¹è±¡çš„å…ƒç´ ï¼Œå†ç»™å®ƒä»¬ä¸€ä¸ªç‰¹æ®Šçš„å±æ€§ï¼š<code>TEXT_ELEMENT</code>ã€‚</p>
<p>å½“æ²¡æœ‰å­å…ƒç´ æ—¶ï¼ŒReactå¹¶æ²¡æœ‰åŒ…è£…åŸå§‹å€¼æˆ–åˆ›å»ºç©ºæ•°ç»„ï¼Œä½†æˆ‘ä»¬æ›´å¸Œæœ›ç®€åŒ–ä»£ç è€Œä¸æ˜¯è¿½æ±‚ä»£ç æ€§èƒ½ğŸ˜€ã€‚</p>
<p>ä¸ºäº†æ›¿æ¢Reactï¼Œæˆ‘ä»¬è¦ç»™è‡ªå·±çš„åº“èµ·ä¸ªåå­—ï¼Œå°±å«<code>Didact</code>å§ï¼ä½†æ˜¯æˆ‘ä»¬ä¾ç„¶æƒ³ä½¿ç”¨<code>JSX</code>è¯­æ³•ï¼Œæ€ä¹ˆå‘Šè¯‰<code>babel</code>è¦ç”¨<code>Didact</code>çš„<code>createElement</code>è€Œä¸æ˜¯<code>React</code>çš„å‘¢ï¼Ÿ</p>
<p>ç”¨è¿™æ ·ä¸€ä¸ªæ³¨é‡Šï¼Œå½“babelç¼–è¯‘<code>JSX</code>æ—¶ï¼Œå°±ä¼šä½¿ç”¨æˆ‘ä»¬å®šä¹‰çš„å‡½æ•°è¾£ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** <span class="doctag">@jsx </span>Didact.createElement */</span></span><br><span class="line"><span class="keyword">const</span> element = (</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;foo&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">a</span>&gt;</span>bar<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">b</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="2-renderå‡½æ•°"><a href="#2-renderå‡½æ•°" class="headerlink" title="2.renderå‡½æ•°"></a>2.<code>render</code>å‡½æ•°</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦å†™ä¸€ä¸ªè‡ªå·±çš„<code>ReactDOM.render</code>å‡½æ•°ã€‚ç°åœ¨å‘¢ï¼Œæˆ‘ä»¬åªå…³å¿ƒå‘DOMä¸­æ·»åŠ ä¸œè¥¿ï¼Œä¹‹åæˆ‘ä»¬å†å®ç°æ›´æ–°å’Œåˆ é™¤ã€‚</p>
<p>æˆ‘ä»¬å…ˆæ ¹æ®<code>element type</code>ç”Ÿæˆä¸€ä¸ªDOMèŠ‚ç‚¹ï¼Œå†æŠŠè¿™ä¸ªæ–°èŠ‚ç‚¹æ·»åŠ åˆ°containerã€‚</p>
<p>æˆ‘ä»¬è¦é€’å½’åœ°å¯¹æ¯ä¸ªå­èŠ‚ç‚¹æ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚åˆ«å¿˜äº†æ–‡æœ¬å…ƒç´ ï¼Œå¦‚æœå…ƒç´ ç±»å‹æ˜¯<code>TEXT_ELEMENT</code>æˆ‘ä»¬å°±ä¼šåˆ›å»ºä¸€ä¸ªæ–‡æœ¬èŠ‚ç‚¹è€Œä¸æ˜¯å¸¸è§„èŠ‚ç‚¹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">element, container</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> dom =</span><br><span class="line">    element.type == <span class="string">&quot;TEXT_ELEMENT&quot;</span></span><br><span class="line">      ? <span class="built_in">document</span>.createTextNode(<span class="string">&quot;&quot;</span>)</span><br><span class="line">      : <span class="built_in">document</span>.createElement(element.type)</span><br><span class="line"></span><br><span class="line">  element.props.children.forEach(<span class="function"><span class="params">child</span> =&gt;</span></span><br><span class="line">    render(child, dom)</span><br><span class="line">  )</span><br></pre></td></tr></table></figure>

<p>æœ€åæˆ‘ä»¬éœ€è¦ç»™èŠ‚ç‚¹åˆ†é…å…ƒç´ å±æ€§ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isProperty = <span class="function"><span class="params">key</span> =&gt;</span> key !== <span class="string">&quot;children&quot;</span></span><br><span class="line">  <span class="built_in">Object</span>.keys(element.props)</span><br><span class="line">    .filter(isProperty)</span><br><span class="line">    .forEach(<span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">      dom[name] = element.props[name]</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<p>å®Œæˆï¼æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªå¯ä»¥æŠŠ<code>JSX</code>æ¸²æŸ“åˆ°DOMä¸­çš„åº“ã€‚</p>
<h2 id="3-å¹¶å‘æ¨¡å‹"><a href="#3-å¹¶å‘æ¨¡å‹" class="headerlink" title="3.å¹¶å‘æ¨¡å‹"></a>3.å¹¶å‘æ¨¡å‹</h2><p>åœ¨å®ç°æ›´å¤šåŠŸèƒ½å‰Â·Â·Â·Â·Â·Â·æˆ‘ä»¬éœ€è¦é‡æ„ä¸€ä¸‹ä»£ç ã€‚</p>
<p>å› ä¸ºæˆ‘ä»¬çš„é€’å½’è°ƒç”¨æœ‰ä¸€ä¸ªé—®é¢˜ã€‚ä¸€æ—¦æˆ‘ä»¬å¼€å§‹æ¸²æŸ“ï¼Œç›´åˆ°æˆ‘ä»¬æ¸²æŸ“å®Œæ•´æ£µelementæ ‘éƒ½ä¸ä¼šåœä¸‹æ¥ã€‚å¦‚æœè¿™æ£µelementæ ‘å¾ˆå¤§çš„è¯ï¼Œå®ƒå¯èƒ½ä¼šä½¿ä¸»çº¿ç¨‹é˜»å¡å¾ˆä¹…ã€‚è€Œä¸”å¦‚æœæµè§ˆå™¨éœ€è¦å®ç°ä¸€æ®µå¹³æ»‘çš„åŠ¨ç”»æˆ–è€…å¤„ç†ç”¨æˆ·è¾“å…¥è¿™ç§é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œå®ƒå°†ä¼šä¸€ç›´ç­‰å¾…ç›´åˆ°æ¸²æŸ“å®Œæˆã€‚</p>
<p>å› æ­¤æˆ‘ä»¬å°†æŠŠå·¥ä½œæ‹†åˆ†æˆå°çš„å•å…ƒï¼Œè€Œä¸”æ¯å½“æˆ‘ä»¬å®Œæˆäº†ä¸€ä¸ªå•å…ƒï¼Œå¦‚æœæœ‰å…¶ä»–äº‹æƒ…è¦åšçš„è¯æˆ‘ä»¬ä¼šè®©æµè§ˆå™¨æ‰“æ–­æ¸²æŸ“ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> nextUnitOfWork = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">workLoop</span>(<span class="params">deadline</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> shouldYield = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">while</span> (nextUnitOfWork &amp;&amp; !shouldYield) &#123; </span><br><span class="line">    <span class="comment">// ä»»åŠ¡åˆ—è¡¨ä¸­è¿˜æœ‰ä¸‹ä¸€ä¸ªå•å…ƒè€Œä¸”è¿˜æœ‰ç©ºé—²æ—¶é—´</span></span><br><span class="line">    nextUnitOfWork = performUnitOfWork(</span><br><span class="line">      <span class="comment">// æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">      nextUnitOfWork</span><br><span class="line">    )</span><br><span class="line">    shouldYield = deadline.timeRemaining() &lt; <span class="number">1</span></span><br><span class="line">   	<span class="comment">// åˆ¤æ–­æ˜¯å¦è¿˜æœ‰ç©ºé—²æ—¶é—´</span></span><br><span class="line">  &#125;</span><br><span class="line">  requestIdleCallback(workLoop)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">requestIdleCallback(workLoop)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">performUnitOfWork</span>(<span class="params">nextUnitOfWork</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// TODO</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬ä½¿ç”¨<code>requestIdleCallback</code>æ¥å®ç°å¾ªç¯ã€‚å¯ä»¥æŠŠ<code>reuqestIdleCallback</code>çœ‹ä½œä¸€ä¸ª<code>setTimeout    </code>,åªä¸è¿‡ä¸æ˜¯æˆ‘ä»¬å‘Šè¯‰ä»–ä»€ä¹ˆæ—¶å€™è¿è¡Œï¼Œ<strong>æµè§ˆå™¨ä¼šåœ¨ä¸»çº¿ç¨‹ç©ºé—²æ—¶è¿è¡Œå›è°ƒå‡½æ•°</strong>ã€‚</p>
<p>Reactä¸å†ä½¿ç”¨<code>requestIdleCallback</code>äº†ï¼Œç°åœ¨äººå®¶ç”¨<em>the scheduler package</em>ï¼Œä½†åœ¨æœ¬ä¾‹ä¸­æ˜¯ä¸€æ ·çš„æ¦‚å¿µã€‚</p>
<p><code>requestIdleCallback</code>è¿˜ç»™äº†æˆ‘ä»¬ä¸€ä¸ªdeadlineå‚æ•°ã€‚æˆ‘ä»¬å°±æ˜¯ç”¨å®ƒæ¥åˆ¤æ–­åœ¨æµè§ˆå™¨è·å¾—æŒæ§æƒä¹‹å‰æˆ‘ä»¬è¿˜æœ‰å¤šå°‘æ—¶é—´çš„ã€‚</p>
<p>æˆ‘ä»¬é€šè¿‡è®¾ç½®ä»»åŠ¡ä¸­çš„ç¬¬ä¸€ä¸ªå•å…ƒæ¥å¯åŠ¨å¾ªç¯ï¼Œæ¥ä¸‹æ¥å†™äº†ä¸€ä¸ª<code>performUnitOfWork</code>å‡½æ•°ï¼Œå³æ‰§è¡Œäº†ä»»åŠ¡åˆè¿”å›äº†ä»»åŠ¡ä¸­çš„ä¸‹ä¸€ä¸ªå•å…ƒã€‚</p>
<h2 id="4-Fibers"><a href="#4-Fibers" class="headerlink" title="4.Fibers"></a>4.<code>Fibers</code></h2><p>ä¸ºäº†ç»„ç»‡ä»»åŠ¡ä¸­çš„æ‰€æœ‰å•å…ƒæˆ‘ä»¬éœ€è¦ä¸€ç§æ•°æ®ç»“æ„ï¼šé‚£å°±æ˜¯<code>fiber</code>æ ‘ã€‚</p>
<p>æ¯ä¸€ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„<code>fiber</code>è€Œä¸”æ¯ä¸ª<code>fiber</code>éƒ½æ˜¯ä»»åŠ¡ä¸­çš„ä¸€ä¸ªå•å…ƒã€‚</p>
<p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦æ¸²æŸ“ä¸€ä¸ªè¿™æ ·çš„elementæ ‘ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Didact.render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">p</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">a</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">h2</span> /&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>,</span><br><span class="line">  container</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>åœ¨<code>render</code>ä¸­æˆ‘ä»¬å°†ä¼šåˆ›å»ºä¸€ä¸ª<code>root fiber</code>ï¼Œå¹¶æŠŠå®ƒè®¾ç½®ä¸º<code>nextUnitOfWork</code>ã€‚æ¥ä¸‹æ¥çš„ä»»åŠ¡å°†ä¼šåœ¨<code>performUnitOfWork</code>ä¸­æ‰§è¡Œï¼Œæˆ‘ä»¬å°†ä¼šå¯¹æ¯ä¸ªfiberåšä¸‰ä»¶äº‹æƒ…ï¼š</p>
<ol>
<li>æŠŠå…ƒç´ æ·»åŠ åˆ°DOMä¸­</li>
<li>ä¸ºå…ƒç´ çš„å­©å­åˆ›å»º<code>fibers</code></li>
<li>é€‰æ‹©ä¸‹ä¸€ä¸ªä»»åŠ¡</li>
</ol>
<p>ï¼ˆä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰çœ‹å‡ºæ¥ï¼Œå…¶å®è¿˜æ˜¯é€’å½’ï¼Œåªä¸è¿‡æˆ‘ä»¬æ²¡æœ‰åœ¨é€’å½’é‡Œé¢ä¸å‡æ€ç´¢åœ°æ¸²æŸ“æ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼ï¼‰</p>
<p>å­¦è¿‡æ•°æ®ç»“æ„çš„åŒå­¦éƒ½åº”è¯¥çŸ¥é“æ ‘é•¿å•¥æ ·ï¼š</p>
<p><img src="C:\Users\luna6\AppData\Roaming\Typora\typora-user-images\image-20211018223652632.png" alt="image-20211018223652632"></p>
<p>å°±é•¿fiberæ ‘è¿™æ ·ï¼å…¶å®æ˜¯fiberæ ‘å°±é•¿æ ‘è¿™æ ·ğŸ˜€é€‰æ‹©è¿™ç§æ•°æ®ç»“æ„å½“ç„¶æ˜¯ä¸ºäº†æ–¹ä¾¿éå†äº†ï¼Œæ¯ä¸ªfiberéƒ½é“¾æ¥ç€å®ƒçš„ç¬¬ä¸€ä¸ªå­©å­èŠ‚ç‚¹ï¼Œç›¸é‚»çš„å…„å¼ŸèŠ‚ç‚¹å’Œå®ƒçš„çˆ¶èŠ‚ç‚¹ã€‚</p>
<p>å½“æˆ‘ä»¬å®Œæˆäº†ä¸€ä¸ªfiberä¸Šçš„ä»»åŠ¡æ—¶ï¼Œå¦‚æœä»–æœ‰<code>child</code>èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå­©å­fiberå°±ä¼šæ˜¯ä»»åŠ¡æ‰§è¡Œçš„ä¸‹ä¸€ä¸ªå•å…ƒã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬å®Œæˆäº†<code>div</code>fiberä¸Šçš„ä»»åŠ¡æ—¶ï¼Œä¸‹ä¸€ä¸ªå•å…ƒå°†ä¼šæ˜¯<code>h1</code>fiberã€‚</p>
<p>å¦‚æœä¸€ä¸ªfiberæ²¡æœ‰<code>child</code>ï¼Œæˆ‘ä»¬æŠŠ<code>sibling</code>å½“ä½œä»»åŠ¡çš„ä¸‹ä¸€ä¸ªå•å…ƒã€‚æ¯”å¦‚ï¼Œ<code>p</code>fiberæ²¡æœ‰<code>child</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å®ƒå®Œæˆä¹‹åæ¥åˆ°äº†<code>a</code>fiberã€‚</p>
<p>å†å¦‚æœä¸€ä¸ªfiberæ—¢æ²¡æœ‰<code>child</code>ä¹Ÿæ²¡æœ‰<code>sibling</code>å‘¢ï¼Œæˆ‘ä»¬æ‰¾åˆ°å®ƒçš„â€œå”å”â€ï¼š<code>parent</code>çš„<code>sibling</code>ã€‚å°±åƒ<code>a</code>fiberå’Œ<code>h2</code>fiberçš„å…³ç³»ã€‚</p>
<p>å½“ç„¶å•¦ï¼Œå¦‚æœ<code>parent</code>ä¹Ÿæ²¡æœ‰<code>sibling</code>çš„è¯ï¼Œæˆ‘ä»¬å°±ä¸€ç›´é¡ºç€<code>parent</code>så‘ä¸Šæ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°äº†ä¸€ä¸ªå…·æœ‰<code>sibling</code>çš„fiberæˆ–è€…åˆ°è¾¾äº†rootã€‚å¦‚æœæˆ‘ä»¬åˆ°è¾¾äº†rootï¼Œä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬å®Œæˆäº†æ­¤æ¬¡<code>render</code>çš„æ‰€æœ‰ä»»åŠ¡ã€‚ï¼ˆç†Ÿæ‚‰æ•°æ®ç»“æ„çš„åŒå­¦ä¸€å®šå¾ˆå¼€å¿ƒå§ï¼è¿™ä¸å°±æ˜¯å…ˆæ ¹éå†çš„è¿‡ç¨‹å˜›ğŸ˜„ï¼‰</p>
<p>æ¥ä¸‹æ¥è®©æˆ‘ä»¬å®ç°ä»£ç éƒ¨åˆ†ï¼š</p>
<p>åœ¨<code>render</code>å‡½æ•°ä¸­æˆ‘ä»¬æŠŠfiber treeçš„rootè®¾ç½®ä¸º<code>nextUnitOfWork</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">element, container</span>) </span>&#123;</span><br><span class="line">  nextUnitOfWork = &#123;</span><br><span class="line">    <span class="attr">dom</span>: container,</span><br><span class="line">    <span class="attr">props</span>: &#123;</span><br><span class="line">      <span class="attr">children</span>: [element],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥ï¼Œå½“æµè§ˆå™¨å‡†å¤‡å¥½æ—¶ï¼Œå®ƒä¼šå›è°ƒæˆ‘ä»¬çš„<code>workLoop</code>ï¼Œæˆ‘ä»¬å°†ä¼šä»<code>root</code>å¼€å§‹æ‰§è¡Œä»»åŠ¡ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°èŠ‚ç‚¹å¹¶æŠŠå®ƒæ·»åŠ åˆ°DOMä¸­ã€‚æˆ‘ä»¬ç”¨<code>fiber.dom</code>å±æ€§æ¥è·Ÿè¸ªè¿™ä¸ªDOMèŠ‚ç‚¹ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">performUnitOfWork</span>(<span class="params">fiber</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!fiber.dom) &#123;</span><br><span class="line">    fiber.dom = createDom(fiber)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (fiber.parent) &#123;</span><br><span class="line">    fiber.parent.dom.appendChild(fiber.dom)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// TODO create new fibers</span></span><br><span class="line">  <span class="comment">// TODO return next unit of work</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¸ºæ¯ä¸ª<code>child</code>åˆ›å»ºä¸€ä¸ªæ–°çš„fiberï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> elements = fiber.props.children</span><br><span class="line">  <span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line">  <span class="keyword">let</span> prevSibling = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (index &lt; elements.length) &#123;</span><br><span class="line">    <span class="keyword">const</span> element = elements[index]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> newFiber = &#123;</span><br><span class="line">      <span class="attr">type</span>: element.type,</span><br><span class="line">      <span class="attr">props</span>: element.props,</span><br><span class="line">      <span class="attr">parent</span>: fiber,</span><br><span class="line">      <span class="attr">dom</span>: <span class="literal">null</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>ç„¶åæˆ‘ä»¬æŠŠå®ƒä½œä¸ºä¸€ä¸ª<code>child</code>æˆ–è€…<code>sibling</code>åŠ å…¥fiber treeï¼Œè¿™å–å†³äºå®ƒæ˜¯ä¸æ˜¯ç¬¬ä¸€ä¸ª<code>child</code>ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (index === <span class="number">0</span>) &#123;</span><br><span class="line">      fiber.child = newFiber</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      prevSibling.sibling = newFiber</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    prevSibling = newFiber</span><br><span class="line">    index++</span><br></pre></td></tr></table></figure>

<p>æœ€åæˆ‘ä»¬å¯»æ‰¾ä»»åŠ¡ä¸­çš„ä¸‹ä¸€ä¸ªå•å…ƒã€‚æˆ‘ä»¬é¦–å…ˆå¯»æ‰¾<code>child</code>ï¼Œæ¥ä¸‹æ¥æ˜¯<code>sibling</code>ï¼Œç„¶åæ˜¯<code>uncle</code>ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (fiber.child) &#123;</span><br><span class="line">   <span class="keyword">return</span> fiber.child</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">let</span> nextFiber = fiber</span><br><span class="line"> <span class="keyword">while</span> (nextFiber) &#123;</span><br><span class="line">   <span class="keyword">if</span> (nextFiber.sibling) &#123;</span><br><span class="line">     <span class="keyword">return</span> nextFiber.sibling</span><br><span class="line">   &#125;</span><br><span class="line">   nextFiber = nextFiber.parent</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™å°±æ˜¯æˆ‘ä»¬çš„<code>performUnitOfWork</code>è¾£ï¼</p>
<p>props: {</p>
<p>â€‹      â€¦props,</p>
<p>â€‹      children: children**.**map(child =&gt; </p>
<p>â€‹        typeof child === â€˜objectâ€™</p>
<p>â€‹          ? child</p>
<p>â€‹          : createTextNode(child)</p>
<p>â€‹      ),</p>
<p>â€‹    },</p>
<p>æ‰‹æ®‹å¤šå†™äº†ä¸ªå¤§æ‹¬å·ï¼Œä¸€ç›´æŠ¥é”™ï¼</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://hemengting.xyz/2021/10/17/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAReact/" data-id="ckuwtunhv000gl4ubeeu61v0o" data-title="ä»0å¼€å§‹å®ç°ä¸€ä¸ªReact" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react-babel/" rel="tag">react babel</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-test" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/10/12/test/" class="article-date">
  <time class="dt-published" datetime="2021-10-12T12:47:34.000Z" itemprop="datePublished">2021-10-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/10/12/test/">test</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>æŠŠhexoé…ç½®æ”¾åœ¨githubä¸Š</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://hemengting.xyz/2021/10/12/test/" data-id="ckuwtunhj0000l4ube2wqhw3z" data-title="test" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ç¿»è¯‘-viewportsçš„æ•…äº‹-part-one" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/23/%E7%BF%BB%E8%AF%91-viewports%E7%9A%84%E6%95%85%E4%BA%8B-part-one/" class="article-date">
  <time class="dt-published" datetime="2021-09-23T07:11:28.000Z" itemprop="datePublished">2021-09-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/23/%E7%BF%BB%E8%AF%91-viewports%E7%9A%84%E6%95%85%E4%BA%8B-part-one/">ç¿»è¯‘:viewportsçš„æ•…äº‹-ç¬¬ä¸€éƒ¨åˆ†</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>åŸæ–‡åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://www.quirksmode.org/mobile/viewports.html">https://www.quirksmode.org/mobile/viewports.html</a></p>
<p>æœ¬æ–‡ä»åƒç´ çš„æ¦‚å¿µå…¥æ‰‹ï¼Œä»‹ç»äº†æµè§ˆå™¨çª—å£ç¼©æ”¾å¸¦æ¥çš„å˜åŒ–ï¼Œ<code>viewport</code>å±æ€§å’Œè·å–<code>viewport</code>å¤§å°çš„å±æ€§ã€‚ä»¥ä¸‹ä¸ºç¿»è¯‘ï¼š</p>
<p><strong>åœ¨è¿™ä¸ªçŸ­ç³»åˆ—ä¸­æˆ‘å°†é˜è¿°<code>viewports</code>å’Œä¸€äº›é‡è¦çš„å…ƒç´ çš„widthså±æ€§æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œæ¯”å¦‚<html>æ ‡ç­¾ã€çª—å£å’Œå±å¹•ã€‚</strong></p>
<p>è¿™ä¸€ç¯‡æ˜¯å…³äºæ¡Œé¢æµè§ˆå™¨çš„ï¼Œå®ƒçš„å”¯ä¸€ç›®çš„æ˜¯ä¸ºç§»åŠ¨æµè§ˆå™¨çš„ç±»ä¼¼è®¨è®ºå¥ å®šåŸºç¡€ã€‚è®¸å¤šwebå¼€å‘è€…å·²ç»å¯¹è®¸å¤šæœ‰å…³æ¡Œé¢çš„æ¦‚å¿µæœ‰äº†ç›´è§‚çš„ç†è§£ã€‚åœ¨æ‰‹æœºç«¯æˆ‘ä»¬å°†ä¼šçœ‹åˆ°ç›¸åŒçš„æ¦‚å¿µï¼Œåªä¸è¿‡æ›´åŠ å¤æ‚ï¼Œä¸€ä¸ªå…³äºå¤§å®¶éƒ½çŸ¥é“çš„æœ¯è¯­çš„å…ˆå¯¼è®¨è®ºå°†ä¼šæå¤§å¸®åŠ©åœ°ä½ ç†è§£æ‰‹æœºæµè§ˆå™¨ã€‚</p>
<h3 id="æ¦‚å¿µï¼šè®¾å¤‡åƒç´ å’Œcssåƒç´ "><a href="#æ¦‚å¿µï¼šè®¾å¤‡åƒç´ å’Œcssåƒç´ " class="headerlink" title="æ¦‚å¿µï¼šè®¾å¤‡åƒç´ å’Œcssåƒç´ "></a>æ¦‚å¿µï¼šè®¾å¤‡åƒç´ å’Œ<code>css</code>åƒç´ </h3><p>ç¬¬ä¸€ä¸ªéœ€è¦ç†è§£çš„æ¦‚å¿µæ˜¯<code>CSS</code>åƒç´ ä»¥åŠå®ƒå’Œè®¾å¤‡åƒç´ çš„åŒºåˆ«ã€‚</p>
<p>è®¾å¤‡åƒç´ å°±æ˜¯æˆ‘ä»¬ç›´è§‰ä¸Šè®¤ä¸ºâ€œæ­£ç¡®â€çš„åƒç´ ã€‚è¿™äº›åƒç´ å°±æ˜¯ä½ æ­£åœ¨ä½¿ç”¨çš„è®¾å¤‡çš„æ­£å¼åˆ†è¾¨ç‡ï¼Œé€šå¸¸å¯ä»¥é€šè¿‡<code>screen.width/height</code>è¯»å–ã€‚</p>
<p>å¦‚æœä½ ç»™æŸä¸ªå…ƒç´ è®¾ç½®<code>width: 128px</code>ï¼Œè€Œä½ çš„æ˜¾ç¤ºå™¨çš„å®½åº¦æ˜¯<code>1024px</code>ï¼Œå¹¶ä¸”ä½ æŠŠæµè§ˆå™¨çª—å£æœ€å¤§åŒ–ï¼Œé‚£ä¹ˆè¿™ä¸ªå…ƒç´ å¯ä»¥åœ¨ä½ çš„æ˜¾ç¤ºå™¨ä¸Šå¡«å……8æ¬¡ï¼ˆç²—ç•¥åœ°;è®©æˆ‘ä»¬å¿½ç•¥æ£˜æ‰‹çš„éƒ¨åˆ†ï¼‰ã€‚</p>
<p>ç„¶è€Œï¼Œå¦‚æœç”¨æˆ·ç¼©æ”¾ï¼Œè¿™ä¸ªè®¡ç®—å…³ç³»å°†ä¼šæ”¹å˜ã€‚å¦‚æœç”¨æˆ·æ”¾å¤§è‡³200%ï¼Œä½ çš„<code>width: 128px</code>çš„å…ƒç´ å°†åªèƒ½åœ¨<code>1024px</code>çš„æ˜¾ç¤ºå™¨å¡«å……4æ¬¡ã€‚</p>
<p>åœ¨ç°ä»£æµè§ˆå™¨ä¸­å®ç°çš„ç¼©æ”¾åªä¸è¿‡æ˜¯â€œæ‰©å±•â€åƒç´ ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸æ˜¯å…ƒç´ çš„å®½åº¦ä»128å˜ä¸º256åƒç´ ï¼›è€Œæ˜¯<em>å®é™…åƒç´ </em>çš„å¤§å°ç¿»å€ã€‚å½¢å¼ä¸Šï¼Œå…ƒç´ çš„å®½åº¦ä»ç„¶æ˜¯128 <code>CSS</code>åƒç´ ï¼Œå³ä½¿å®ƒæ°å¥½å ç”¨256ä¸ªè®¾å¤‡åƒç´ çš„ç©ºé—´ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œæ”¾å¤§200%ä½¿<code>CSS</code>åƒç´ æ‰©å¤§ä¸ºè®¾å¤‡åƒç´ çš„å››å€ã€‚ï¼ˆå®½åº¦ä¸¤å€ï¼Œé«˜åº¦ä¸¤å€ï¼Œæ€»å…±å››å€ï¼‰ã€‚</p>
<p>ä¸€äº›å›¾ç‰‡å¯ä»¥æ˜ç¡®è¿™äº›æ¦‚å¿µã€‚è¿™æ˜¯åœ¨100%ç¼©æ”¾çº§åˆ«çš„å››ä¸ªåƒç´ ï¼Œ<code>CSS</code>åƒç´ ä¸è®¾å¤‡åƒç´ å®Œå…¨é‡å ã€‚</p>
<p><img src="https://www.quirksmode.org/mobile/pix/viewport/csspixels_100.gif" alt="img"></p>
<p>ç°åœ¨è®©æˆ‘ä»¬ç¼©å°ã€‚<code>CSS</code>åƒç´ å¼€å§‹æ”¶ç¼©ï¼Œè¿™æ„å‘³ç€ä¸€ä¸ªè®¾å¤‡åƒç´ ç°åœ¨é‡å äº†å‡ ä¸ª<code>CSS</code>åƒç´ ã€‚</p>
<p><img src="https://www.quirksmode.org/mobile/pix/viewport/csspixels_out.gif" alt="img"></p>
<p>å¦‚æœä½ æ”¾å¤§ï¼Œä¼šå‘ç”Ÿç›¸åçš„æƒ…å†µã€‚<code>CSS</code>åƒç´ å¼€å§‹å¢é•¿ï¼Œç°åœ¨ä¸€ä¸ª<code>CSS</code>åƒç´ é‡å äº†å‡ ä¸ªè®¾å¤‡åƒç´ ã€‚</p>
<p><img src="https://www.quirksmode.org/mobile/pix/viewport/csspixels_in.gif" alt="img"></p>
<p>å…³é”®ç‚¹åœ¨äº<em>æˆ‘ä»¬åªå…³å¿ƒ<code>CSS</code>åƒç´ </em>ã€‚æ­£æ˜¯è¿™äº›åƒç´ å†³å®šäº†æ ·å¼è¡¨çš„å‘ˆç°æ–¹å¼ã€‚</p>
<p>è®¾å¤‡åƒç´ å‡ ä¹æ²¡ç”¨ã€‚ä¸æ˜¯å¯¹ç”¨æˆ·ï¼›ç”¨æˆ·ä¼šæ”¾å¤§æˆ–ç¼©å°é¡µé¢ï¼Œç›´åˆ°å¯ä»¥èˆ’æœåœ°é˜…è¯»å®ƒã€‚ç„¶è€Œï¼Œç¼©æ”¾çº§åˆ«å¯¹ä½ æ¥è¯´å¹¶ä¸é‡è¦ã€‚æµè§ˆå™¨ä¼šè‡ªåŠ¨ç¡®ä¿ä½ çš„<code>CSS</code>å¸ƒå±€è¢«æ‹‰ä¼¸æˆ–å‹ç¼©ã€‚</p>
<p>ï¼ˆç»“è®ºï¼šç¼©å°å°±æ˜¯ç¼©å°<code>CSS</code>åƒç´ ï¼Œæ”¾å¤§å°±æ˜¯æ”¾å¤§<code>CSS</code>åƒç´ ï¼‰</p>
<h3 id="100-ç¼©æ”¾"><a href="#100-ç¼©æ”¾" class="headerlink" title="100%ç¼©æ”¾"></a>100%ç¼©æ”¾</h3><p>æˆ‘ä¸€å¼€å§‹ç”¨å‡è®¾ç¼©æ”¾çº§åˆ«ä¸º100%ä¸¾ä¾‹ã€‚ç°åœ¨æ˜¯æ—¶å€™æ›´ä¸¥æ ¼åœ°å®šä¹‰å®ƒäº†ï¼š</p>
<blockquote>
<p>åœ¨ç¼©æ”¾çº§åˆ«100%ï¼Œä¸€ä¸ª<code>CSS</code>åƒç´ å®Œå…¨ç­‰äºä¸€ä¸ªè®¾å¤‡åƒç´ ã€‚</p>
</blockquote>
<p>100%ç¼©æ”¾çš„æ¦‚å¿µåœ¨æ¥ä¸‹æ¥çš„è¯´æ˜ä¸­éå¸¸æœ‰ç”¨ï¼Œä½†åœ¨æ—¥å¸¸å·¥ä½œä¸­ä½ ä¸åº”è¯¥è¿‡åº¦å…³æ³¨å®ƒã€‚åœ¨æ¡Œé¢ï¼Œä½ é€šå¸¸ä¼šç”¨100%çš„ç¼©æ”¾æ¥æµ‹è¯•ä½ çš„ç½‘ç«™ï¼Œä½†å³ä½¿ç”¨æˆ·æ”¾å¤§æˆ–ç¼©å°ï¼Œç¥å¥‡çš„<code>CSS</code>åƒç´ ä¹Ÿä¼šç¡®ä¿ä½ çš„å¸ƒå±€ä¿æŒç›¸åŒçš„æ¯”ä¾‹ã€‚</p>
<h3 id="å±å¹•å°ºå¯¸-Screen-size"><a href="#å±å¹•å°ºå¯¸-Screen-size" class="headerlink" title="å±å¹•å°ºå¯¸ Screen size"></a>å±å¹•å°ºå¯¸ Screen size</h3><p>è®©æˆ‘ä»¬çœ‹çœ‹ä¸€äº›å®é™…çš„æµ‹é‡æ–¹æ³•ã€‚æˆ‘ä»¬ä»<code>screen.width</code>å’Œ<code>screen.height</code>å¼€å§‹ã€‚å®ƒä»¬åŒ…å«ç”¨æˆ·å±å¹•çš„æ€»å®½åº¦å’Œé«˜åº¦ã€‚è¿™äº›å°ºå¯¸ç”¨è®¾å¤‡åƒç´ æ¥è¡¡é‡ï¼Œå› ä¸ºå®ƒä»¬æ°¸è¿œä¸ä¼šæ”¹å˜ï¼šå®ƒä»¬æ˜¯æ˜¾ç¤ºå™¨çš„ç‰¹æ€§ï¼Œè€Œä¸æ˜¯æµè§ˆå™¨çš„ç‰¹æ€§ã€‚</p>
<p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_screen.jpg" alt="img"></p>
<p>æœ‰è¶£ï¼ä½†è¿™äº›ä¿¡æ¯åŸºæœ¬ä¸Šæ²¡ä»€ä¹ˆç”¨ã€‚ç”¨æˆ·æ˜¾ç¤ºå™¨çš„å¤§å°å¯¹æˆ‘ä»¬æ¥è¯´å¹¶ä¸é‡è¦ï¼Œé™¤éä½ æƒ³åœ¨webç»Ÿè®¡æ•°æ®åº“ä¸­ä½¿ç”¨å®ƒã€‚</p>
<h3 id="çª—å£å°ºå¯¸-Window-size"><a href="#çª—å£å°ºå¯¸-Window-size" class="headerlink" title="çª—å£å°ºå¯¸ Window size"></a>çª—å£å°ºå¯¸ Window size</h3><p>ç›¸åï¼Œæˆ‘ä»¬æƒ³çŸ¥é“çš„æ˜¯æµè§ˆå™¨çª—å£çš„å†…éƒ¨å°ºå¯¸ã€‚å®ƒä¼šå‘Šè¯‰ä½ ç”¨æˆ·å½“å‰æœ‰å¤šå°‘ç©ºé—´ç”¨æ¥å±•ç¤ºä½ çš„<code>CSS</code>å¸ƒå±€ã€‚ä½ å¯ä»¥é€šè¿‡<code>Window.innerWidth</code>å’Œ<code>window.innerHeight</code>æ¥æŸ¥è¯¢è¿™äº›å°ºå¯¸ã€‚</p>
<p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_inner.jpg" alt="img"></p>
<p>æ˜¾ç„¶ï¼Œçª—å£çš„å†…éƒ¨å®½åº¦æ˜¯ä»¥<code>CSS</code>åƒç´ è¡¡é‡çš„ã€‚ä½ éœ€è¦çŸ¥é“ä½ çš„å¸ƒå±€æœ‰å¤šå°‘å¯ä»¥æŒ¤è¿›æµè§ˆå™¨çª—å£ï¼Œå¹¶ä¸”è¿™ä¸ªæ•°é‡ä¼šéšç€ç”¨æˆ·çš„æ”¾å¤§è€Œå‡å°‘ã€‚å¦‚æœç”¨æˆ·æ”¾å¤§ä½ ä¼šå¾—åˆ°æ›´å°‘çš„å¯ç”¨ç©ºé—´ï¼Œ<code>innerWidth/Height</code>çš„é€’å‡å¯ä»¥åæ˜ è¿™ä¸€ç‚¹ã€‚</p>
<p>ï¼ˆzoomçš„æ—¶å€™è™½ç„¶çœ‹èµ·æ¥æµè§ˆå™¨çª—å£å¤§å°æ²¡æœ‰å˜åŒ–ï¼Œä½†æ˜¯innerWidthå˜åŒ–äº†ï¼Œå°±åƒæ”¾å¤§é•œæ•ˆæœä¸€æ ·ï¼Œèƒ½çœ‹è§å†…å®¹çš„åŒºåŸŸå˜åŒ–äº†ï¼‰</p>
<p>ï¼ˆOperaæ˜¯ä¸ªä¾‹å¤–ï¼Œå½“ç”¨æˆ·æ”¾å¤§æ—¶ï¼Œå®ƒçš„<code>innerWidth/Height</code>ä¸ä¼šå‡å°‘ï¼šå®ƒä»¬æ˜¯ä»¥è®¾å¤‡åƒç´ è¡¡é‡çš„ã€‚è¿™åœ¨å°å¼æœºä¸Šå¾ˆçƒ¦äººï¼Œä½†åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå´æ˜¯è‡´å‘½çš„ï¼Œæˆ‘ä»¬ç¨åä¼šçœ‹åˆ°ã€‚)</p>
<p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_inner_zoomed.jpg" alt="img"></p>
<p>æ³¨æ„ï¼Œæµ‹é‡çš„å®½åº¦å’Œé«˜åº¦åŒ…æ‹¬æ»šåŠ¨æ¡ã€‚å®ƒä»¬ä¹Ÿè¢«è®¤ä¸ºæ˜¯å†…çª—çš„ä¸€éƒ¨åˆ†ã€‚(è¿™ä¸»è¦æ˜¯ç”±äºå†å²åŸå› ã€‚)</p>
<h3 id="æ»šåŠ¨æŠµæ¶ˆ-Scrolling-offset"><a href="#æ»šåŠ¨æŠµæ¶ˆ-Scrolling-offset" class="headerlink" title="æ»šåŠ¨æŠµæ¶ˆ Scrolling offset"></a>æ»šåŠ¨æŠµæ¶ˆ Scrolling offset</h3><p><code>window.pageXOffset</code>å’Œ<code>window.pageYOffset</code>åŒ…å«æ–‡æ¡£çš„æ°´å¹³å’Œå‚ç›´æ»šåŠ¨åç§»é‡ã€‚è¿™æ ·ä½ å°±å¯ä»¥çŸ¥é“ç”¨æˆ·æ»šåŠ¨äº†å¤šå°‘ã€‚</p>
<p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_page.jpg" alt="img"></p>
<p>è¿™äº›å±æ€§ä¹Ÿæ˜¯ç”¨<code>CSS</code>åƒç´ åº¦é‡çš„ã€‚ä½ æƒ³çŸ¥é“æ–‡æ¡£å·²ç»å‘ä¸Šæ»šåŠ¨äº†å¤šå°‘ï¼Œä¸ç®¡ç¼©æ”¾çŠ¶æ€æ˜¯ä»€ä¹ˆã€‚</p>
<p>ç†è®ºä¸Šï¼Œå¦‚æœç”¨æˆ·å‘ä¸Šæ»šåŠ¨ï¼Œç„¶åæ”¾å¤§ï¼Œ<code>windw.pageX / YOffset</code>ä¼šæ”¹å˜ã€‚ç„¶è€Œï¼Œæµè§ˆå™¨è¯•å›¾ä¿æŒç½‘é¡µçš„ä¸€è‡´æ€§ï¼Œé€šè¿‡å½“ç”¨æˆ·æ”¾å¤§æ—¶ï¼Œåœ¨å¯è§é¡µé¢çš„é¡¶éƒ¨ä¿æŒç›¸åŒçš„å…ƒç´ æ¥å®ç°ã€‚è¿™å¹¶ä¸æ€»æ˜¯å®Œç¾çš„ï¼Œä½†è¿™æ„å‘³ç€åœ¨å®è·µä¸­<code>window.pageX/YOffset</code>å¹¶æ²¡æœ‰çœŸæ­£æ”¹å˜ï¼šå·²ç»æ»šåŠ¨å‡ºçª—å£çš„<code>CSS</code>åƒç´ æ•°é‡ä¿æŒ(å¤§è‡´)ç›¸åŒã€‚</p>
<p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_page_zoomed.jpg" alt="img"></p>
<h3 id="æ¦‚å¿µ-è§†å£the-viewport"><a href="#æ¦‚å¿µ-è§†å£the-viewport" class="headerlink" title="æ¦‚å¿µ: è§†å£the viewport"></a>æ¦‚å¿µ: è§†å£the <code>viewport</code></h3><p>åœ¨æˆ‘ä»¬ç»§ç»­è®¨è®ºæ›´å¤šçš„JavaScriptå±æ€§ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å¼•å…¥å¦ä¸€ä¸ªæ¦‚å¿µï¼šè§†å£ <code>the viewport</code>ã€‚</p>
<p><code>viewport</code>çš„åŠŸèƒ½æ˜¯çº¦æŸ<html>å…ƒç´ ï¼Œå®ƒæ˜¯ç½‘é¡µæœ€ä¸Šé¢çš„åŒ…å«å—ã€‚</p>
<p>è¿™å¬èµ·æ¥å¯èƒ½æœ‰ç‚¹æ¨¡ç³Šï¼Œæ‰€ä»¥è¿™é‡Œæœ‰ä¸€ä¸ªå®é™…çš„ä¾‹å­ã€‚å‡è®¾ä½ æœ‰ä¸€ä¸ªæµå¼å¸ƒå±€ï¼Œå…¶ä¸­ä¸€ä¸ªä¾§è¾¹æ å®½åº¦ä¸º10%ã€‚ç°åœ¨ï¼Œè¾¹æ ä¼šéšç€ä½ è°ƒæ•´æµè§ˆå™¨çª—å£çš„å¤§å°è€Œæ•´é½åœ°å¢é•¿å’Œæ”¶ç¼©ã€‚ä½†è¿™åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹å‘¢?</p>
<p>ä»æŠ€æœ¯ä¸Šè®²ï¼Œä¾§è¾¹æ çš„å®½åº¦æ˜¯å…¶çˆ¶æ çš„10%ã€‚æˆ‘ä»¬å‡è®¾è¿™æ˜¯<body>(å¹¶ä¸”ä½ æ²¡æœ‰ç»™å®ƒè®¾ç½®å®½åº¦)ã€‚é—®é¢˜æ˜¯<body>çš„å®½åº¦æ˜¯å¤šå°‘ã€‚</p>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å—çº§å…ƒç´ çš„å®½åº¦éƒ½æ˜¯å…¶çˆ¶å…ƒç´ çš„100%(å½“ç„¶ä¹Ÿæœ‰ä¾‹å¤–ï¼Œä½†æˆ‘ä»¬å…ˆå¿½ç•¥å®ƒä»¬)ã€‚æ‰€ä»¥<body>å’Œå®ƒçš„çˆ¶å…ƒç´ <html>ä¸€æ ·å®½ã€‚</p>
<html>å…ƒç´ æœ‰å¤šå®½ï¼Ÿå®ƒå’Œæµè§ˆå™¨çª—å£ä¸€æ ·å®½ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ çš„ä¾§è¾¹æ `width:10%`å°†è·¨è¶Šæ•´ä¸ªæµè§ˆå™¨çª—å£çš„10%ã€‚æ‰€æœ‰çš„webå¼€å‘äººå‘˜éƒ½ç›´è§‚åœ°çŸ¥é“å¹¶ä½¿ç”¨è¿™ä¸ªäº‹å®ã€‚

<p>ä½ å¯èƒ½ä¸çŸ¥é“è¿™åœ¨ç†è®ºä¸Šæ˜¯å¦‚ä½•è¿ä½œçš„ã€‚ç†è®ºä¸Šï¼Œ<html>å…ƒç´ çš„å®½åº¦å—<code>viewport</code>å®½åº¦çš„é™åˆ¶ã€‚<html>å…ƒç´ å <code>viewport</code>å®½åº¦çš„100%ã€‚</p>
<p><code>viewport</code>ï¼Œåè¿‡æ¥ï¼Œå®Œå…¨ç­‰äºæµè§ˆå™¨çª—å£ï¼šå®ƒæ˜¯è¿™æ ·å®šä¹‰çš„ã€‚<code>viewport</code>ä¸æ˜¯HTMLæ„é€ ï¼Œå› æ­¤ä¸èƒ½é€šè¿‡<code>CSS</code>æ¥å½±å“å®ƒã€‚å®ƒåªæ˜¯æ¡Œé¢æµè§ˆå™¨çª—å£çš„å®½åº¦å’Œé«˜åº¦ã€‚åœ¨ç§»åŠ¨å¹³å°ä¸Šåˆ™è¦å¤æ‚å¾—å¤šã€‚</p>
<h3 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h3><p>è¿™ç§æƒ…å†µäº§ç”Ÿäº†ä¸€äº›å¥‡æ€ªçš„åæœã€‚ä½ å¯ä»¥åœ¨è¿™ä¸ªç½‘ç«™ä¸Šçœ‹åˆ°å…¶ä¸­ä¸€ä¸ªã€‚ä¸€ç›´æ»šåŠ¨åˆ°é¡¶éƒ¨ï¼Œæ”¾å¤§ä¸¤åˆ°ä¸‰å€ï¼Œè¿™æ ·ç½‘ç«™çš„å†…å®¹å°±ä¼šæº¢å‡ºæµè§ˆå™¨çª—å£ã€‚</p>
<p>ç°åœ¨å‘å³æ»šåŠ¨ï¼Œä½ ä¼šçœ‹åˆ°ç½‘ç«™é¡¶éƒ¨çš„è“è‰²æ¡ä¸å†æ­£ç¡®æ’åˆ—ã€‚</p>
<p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_htmlbehaviour.jpg" alt="img"></p>
<p>è¿™ç§è¡Œä¸ºæ˜¯<code>viewport</code>å®šä¹‰æ–¹å¼çš„ç»“æœã€‚æˆ‘ç»™é¡¶éƒ¨çš„è“è‰²æ¡å®šä¹‰<code>width:100%</code>ã€‚æ˜¯è°çš„100%ï¼Ÿ<html>å…ƒç´ ï¼Œå®ƒä¸<code>viewport</code>ä¸€æ ·å®½ï¼Œ<code>viewport</code>ä¸æµè§ˆå™¨çª—å£ä¸€æ ·å®½ã€‚</p>
<p>å…³é”®ç‚¹åœ¨äºï¼šè™½ç„¶åœ¨100%ç¼©æ”¾æ—¶å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œä½†ç°åœ¨æˆ‘ä»¬å·²ç»ç¼©å°äº†<code>viewport</code>ï¼Œå®ƒæ¯”æˆ‘çš„ç½‘ç«™çš„æ€»å®½åº¦è¿˜å°ã€‚è¿™æœ¬èº«å¹¶ä¸é‡è¦ï¼Œå†…å®¹ç°åœ¨ä»<html>å…ƒç´ æº¢å‡ºï¼Œä½†è¯¥å…ƒç´ å…·æœ‰<code>overflow: visible</code>ï¼Œè¿™æ„å‘³ç€æº¢å‡ºçš„å†…å®¹å°†åœ¨ä»»ä½•æƒ…å†µä¸‹æ˜¾ç¤ºã€‚</p>
<p>ä½†æ˜¯è“è‰²çš„æ¡å¹¶æ²¡æœ‰æº¢å‡ºæ¥ã€‚å› ä¸ºæˆ‘ç»™å®ƒè®¾ç½®äº†<code>width:100%</code>ï¼Œæ¯•ç«Ÿï¼Œæµè§ˆå™¨é€šè¿‡æŠŠ<code>viewport</code>çš„å®½åº¦åº”ç”¨åœ¨è“è‰²æ¡ä¸Šæ¥éµå®ˆè¿™ä¸€è®¾ç½®ã€‚ä»–ä»¬å¹¶ä¸å…³å¿ƒå®½åº¦ç°åœ¨å¤ªçª„äº†ã€‚</p>
<p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_100percent.jpg" alt="img"></p>
<h3 id="æ–‡æ¡£å®½åº¦"><a href="#æ–‡æ¡£å®½åº¦" class="headerlink" title="æ–‡æ¡£å®½åº¦?"></a>æ–‡æ¡£å®½åº¦?</h3><p>æˆ‘çœŸæ­£éœ€è¦çŸ¥é“çš„æ˜¯æ•´ä¸ªé¡µé¢çš„å†…å®¹æœ‰å¤šå®½ï¼ŒåŒ…æ‹¬é‚£äº›çªå‡ºçš„éƒ¨åˆ†ã€‚æ®æˆ‘æ‰€çŸ¥ï¼Œä¸å¯èƒ½æ‰¾åˆ°è¿™ä¸ªå€¼(é™¤éä½ å»è®¡ç®—é¡µé¢ä¸Šæ‰€æœ‰å…ƒç´ çš„å®½åº¦å’Œé¡µè¾¹è·ï¼Œä½†è¯´å¾—å§”å©‰äº›ï¼Œè¿™å¾ˆå®¹æ˜“å‡ºé”™)ã€‚</p>
<p>æˆ‘ç›¸ä¿¡æˆ‘ä»¬éœ€è¦ä¸€ä¸ªJavaScriptå±æ€§å¯¹ï¼Œæ¥ç»™å‡ºæˆ‘æ‰€è¯´çš„â€œæ–‡æ¡£å®½åº¦â€(æ˜¾ç„¶æ˜¯<code>CSS</code>åƒç´ )ã€‚</p>
<p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_documentwidth.jpg" alt="img"></p>
<p>å¦‚æœæˆ‘ä»¬çœŸçš„è§‰å¾—å¾ˆéš¾ï¼Œä¸ºä»€ä¹ˆä¸æŠŠè¿™ä¸ªå€¼ä¹Ÿæš´éœ²ç»™<code>CSS</code>å‘¢ï¼Ÿæˆ‘å¸Œæœ›èƒ½å¤Ÿä½¿è“è‰²æ¡çš„<code>width:100%</code>å±æ€§ä¾èµ–äºæ–‡æ¡£çš„å®½åº¦ï¼Œè€Œä¸æ˜¯<html>å…ƒç´ çš„å®½åº¦ã€‚(ä¸è¿‡ï¼Œè¿™è‚¯å®šå¾ˆæ£˜æ‰‹ï¼Œå¦‚æœæ— æ³•å®ç°ï¼Œæˆ‘ä¹Ÿä¸ä¼šæ„Ÿåˆ°æƒŠè®¶ã€‚)</p>
<p>æµè§ˆå™¨å‚å•†ä»¬ï¼Œä½ ä»¬æ€ä¹ˆçœ‹?</p>
<h3 id="æµ‹é‡viewport"><a href="#æµ‹é‡viewport" class="headerlink" title="æµ‹é‡viewport"></a>æµ‹é‡<code>viewport</code></h3><p>ä½ å¯èƒ½æƒ³çŸ¥é“è§†å£çš„å°ºå¯¸ã€‚å®ƒä»¬å¯ä»¥åœ¨<code>document.documentElement.clientWidth</code>å’Œ<code>-Height</code>ä¸­æ‰¾åˆ°ã€‚</p>
<p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_client.jpg" alt="img"></p>
<p>å¦‚æœäº†è§£DOMï¼Œå°±ä¼šäº†è§£<code>document.documentElement</code>å®é™…ä¸Šæ˜¯<html>å…ƒç´ ï¼šä»»ä½•<code>html</code>æ–‡æ¡£çš„æ ¹å…ƒç´ ã€‚ç„¶è€Œï¼Œå¯ä»¥è¯´è§†å£æ›´é«˜ä¸€çº§ï¼›å®ƒæ˜¯åŒ…å«<html>å…ƒç´ çš„å…ƒç´ ã€‚å¦‚æœç»™<html>å…ƒç´ ä¸€ä¸ªå®½åº¦ï¼Œè¿™å¯èƒ½å¾ˆé‡è¦ã€‚(é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œæˆ‘ä¸å»ºè®®è¿™ä¹ˆåšï¼Œä½†è¿™æ˜¯å¯èƒ½çš„ã€‚)</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>document.documentElement.clientWidth</code>å’Œ<code>-Height</code>ä»ç„¶ç»™å‡ºè§†å£çš„å°ºå¯¸ï¼Œè€Œä¸æ˜¯<html>å…ƒç´ çš„å°ºå¯¸ã€‚(è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è§„åˆ™ï¼Œåªé€‚ç”¨äºè¿™ä¸ªå…ƒç´ ï¼Œåªé€‚ç”¨äºè¿™ä¸ªå±æ€§å¯¹ã€‚åœ¨æ‰€æœ‰å…¶ä»–æƒ…å†µä¸‹ï¼Œä½¿ç”¨å…ƒç´ çš„å®é™…å®½åº¦ã€‚)</p>
<p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_client_smallpage.jpg" alt="img"></p>
<p>å› æ­¤<code>document.documentElement.clientWidth</code>å’Œ<code>-Height</code>æ€»æ˜¯ç»™å‡ºè§†å£çš„å°ºå¯¸ï¼Œè€Œä¸ç®¡<html>å…ƒç´ çš„å°ºå¯¸ã€‚</p>
<h3 id="ä¸¤ä¸ªå±æ€§å¯¹"><a href="#ä¸¤ä¸ªå±æ€§å¯¹" class="headerlink" title="ä¸¤ä¸ªå±æ€§å¯¹"></a>ä¸¤ä¸ªå±æ€§å¯¹</h3><p>ä½†æ˜¯è§†çª—å®½åº¦çš„å°ºå¯¸ä¸ä¹Ÿæ˜¯ç”±<code>window.innerWidth/Height</code>ç»™å‡ºçš„å—?æ˜¯ä¹Ÿä¸æ˜¯ã€‚</p>
<p>è¿™ä¸¤ä¸ªå±æ€§å¯¹ä¹‹é—´æœ‰ä¸€ä¸ªå½¢å¼ä¸Šçš„åŒºåˆ«ï¼š<code>document.documentElement.clientWidth</code>å’Œ<code>-Height</code>ä¸åŒ…æ‹¬æ»šåŠ¨æ¡ï¼Œè€Œ<code>window.innerWidth/Height</code>åŒ…æ‹¬ã€‚ä¸è¿‡ï¼Œè¿™åŸºæœ¬ä¸Šæ˜¯ä¸€ç§å¹æ¯›æ±‚ç–µã€‚</p>
<p>æˆ‘ä»¬æœ‰ä¸¤ä¸ªå±æ€§å¯¹çš„ç°çŠ¶æ˜¯æµè§ˆå™¨ä¹‹æˆ˜é—ç•™ä¸‹æ¥çš„ã€‚é‚£æ—¶<code>Netscape</code>åªæ”¯æŒ<code>window.innerWidth/Height</code>è€ŒIEä»…æ”¯æŒ<code>document.documentElement.clientWidth</code>å’Œ<code>-Height</code>ã€‚ä»é‚£æ—¶èµ·ï¼Œæ‰€æœ‰å…¶ä»–æµè§ˆå™¨éƒ½å¼€å§‹æ”¯æŒ<code>clientWidth/Height</code>ï¼Œä½†IEæ²¡æœ‰é€‰æ‹©<code>window.innerWidth/Height</code>ã€‚</p>
<p>åœ¨å°å¼æœºä¸Šæœ‰ä¸¤ä¸ªå¯ç”¨çš„å±æ€§å¯¹æ˜¯ä¸€ä¸ªå°éº»çƒ¦â€”â€”ä½†åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå´æ˜¯ä¸€ä¸ªç¦éŸ³ï¼Œæ­£å¦‚æˆ‘ä»¬å°†çœ‹åˆ°çš„ã€‚</p>
<h3 id="æµ‹é‡å…ƒç´ "><a href="#æµ‹é‡å…ƒç´ " class="headerlink" title="æµ‹é‡å…ƒç´ "></a>æµ‹é‡<html>å…ƒç´ </h3><p>æ‰€ä»¥<code>clientWidth/Height</code>ç»™å‡ºäº†æ‰€æœ‰æƒ…å†µä¸‹çš„è§†å£å°ºå¯¸ã€‚ä½†æ˜¯æˆ‘ä»¬åœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°<html>å…ƒç´ æœ¬èº«çš„å°ºå¯¸å‘¢?å®ƒä»¬å­˜å‚¨åœ¨<code>document.documentElement.offsewidth</code>å’Œ<code>-Height</code>ä¸­ã€‚</p>
<p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_offset.jpg" alt="img"></p>
<p>è¿™äº›å±æ€§çœŸæ­£åœ°è®©ä½ ä»¥å—çº§å…ƒç´ çš„æ–¹å¼è®¿é—®<html>å…ƒç´ ï¼›å¦‚æœä½ è®¾ç½®<code>width</code>ï¼Œ<code>offsetWidth</code>å°†åæ˜ å®ƒã€‚</p>
<p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_offset_smallpage.jpg" alt="img"></p>
<h3 id="äº‹ä»¶çš„åæ ‡"><a href="#äº‹ä»¶çš„åæ ‡" class="headerlink" title="äº‹ä»¶çš„åæ ‡"></a>äº‹ä»¶çš„åæ ‡</h3><p>ç„¶åæ˜¯äº‹ä»¶åæ ‡ã€‚å½“é¼ æ ‡äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè‡³å°‘ä¼šæš´éœ²5ä¸ªå±æ€§å¯¹ä»¥æä¾›æœ‰å…³äº‹ä»¶ç¡®åˆ‡ä½ç½®çš„ä¿¡æ¯ã€‚å¯¹äºæˆ‘ä»¬çš„è®¨è®ºï¼Œå…¶ä¸­ä¸‰ä¸ªæ˜¯é‡è¦çš„ï¼š</p>
<blockquote>
<ol>
<li><code>pageX/Y</code>ä»¥<code>CSS</code>åƒç´ ç»™å‡ºå…ƒç´ ç›¸å¯¹äº<html>å…ƒç´ çš„åæ ‡ã€‚</li>
<li><code>clientX/Y</code>ä»¥<code>CSS</code>åƒç´ ç»™å‡ºå…ƒç´ ç›¸å¯¹äº<code>viewport</code>çš„å…ƒç´ åæ ‡ã€‚</li>
<li><code>screenX/Y</code> ä»¥<code>CSS</code>åƒç´ ç»™å‡ºç›¸å¯¹äºå±å¹•çš„åæ ‡ã€‚</li>
</ol>
</blockquote>
<p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_pageXY.jpg" alt="img"></p>
<p>90%çš„æ—¶é—´ä½ éƒ½ä¼šéƒ½ä½¿ç”¨<code>pageX/Y</code>ï¼›é€šå¸¸ï¼Œä½ æƒ³çŸ¥é“äº‹ä»¶ç›¸å¯¹äºæ–‡æ¡£çš„ä½ç½®ã€‚å¦å¤–10%çš„æ—¶é—´ä½ ä¼šä½¿ç”¨<code>clientX/Y</code>ã€‚æ‚¨æ°¸è¿œä¸éœ€è¦çŸ¥é“ç›¸å¯¹äºå±å¹•çš„äº‹ä»¶åæ ‡ã€‚</p>
<h3 id="åª’ä½“æŸ¥è¯¢"><a href="#åª’ä½“æŸ¥è¯¢" class="headerlink" title="åª’ä½“æŸ¥è¯¢"></a>åª’ä½“æŸ¥è¯¢</h3><p>æœ€åï¼Œä¸€äº›å…³äºåª’ä½“æŸ¥è¯¢çš„è¯æ±‡ã€‚å…¶æ€æƒ³éå¸¸ç®€å•ï¼šæ‚¨å¯ä»¥å®šä¹‰ç‰¹æ®Šçš„<code>CSS</code>è§„åˆ™ï¼Œè¿™äº›è§„åˆ™åªåœ¨é¡µé¢å®½åº¦å¤§äºã€ç­‰äºæˆ–å°äºç‰¹å®šå¤§å°æ—¶æ‰§è¡Œã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">div</span><span class="selector-class">.sidebar</span> &#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> all <span class="keyword">and</span> (<span class="attribute">max-width</span>: <span class="number">400px</span>) &#123;</span><br><span class="line">	// styles assigned when <span class="attribute">width</span> is smaller than <span class="number">400px</span>;</span><br><span class="line">	<span class="selector-tag">div</span><span class="selector-class">.sidebar</span> &#123;</span><br><span class="line">		<span class="attribute">width</span>: <span class="number">100px</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ä¾§è¾¹æ æ˜¯<code>300px</code>å®½ï¼Œé™¤éå®½åº¦å°äº<code>400px</code>ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ä¾§è¾¹æ å˜æˆ<code>100px</code>å®½ã€‚</p>
<p>é—®é¢˜å½“ç„¶æ˜¯ï¼šæˆ‘ä»¬æµ‹é‡çš„å®½åº¦æ˜¯å¤šå°‘?</p>
<p>æœ‰ä¸¤ä¸ªç›¸å…³çš„åª’ä½“æŸ¥è¯¢:``width/height<code>å’Œ</code>device-width/device-height`ã€‚</p>
<ol>
<li><code>width/height</code> ä½¿ç”¨ä¸<code>documentElement.clientwidth /Height</code>ï¼ˆæ¢å¥è¯è¯´ï¼Œ<code>viewport</code>ï¼‰ã€‚å®ƒé€‚ç”¨äº<code>CSS</code>åƒç´ ã€‚</li>
<li><code>device-width/device-height</code> ä½¿ç”¨ä¸<code>screen.width/height</code>ç›¸åŒçš„å€¼ã€‚(æ¢å¥è¯è¯´ï¼Œå±å¹•)ã€‚å®ƒé€‚ç”¨äºè®¾å¤‡åƒç´ ã€‚</li>
</ol>
<p><img src="https://www.quirksmode.org/mobile/pix/viewport/desktop_mediaqueries.jpg" alt="img"></p>
<p>ä½ åº”è¯¥ä½¿ç”¨å“ªä¸€ç§ï¼Ÿæ˜¾è€Œæ˜“è§ï¼Œ<code>width</code>ã€‚Webå¼€å‘äººå‘˜å¯¹è®¾å¤‡å®½åº¦ä¸æ„Ÿå…´è¶£ï¼›é‡è¦çš„æ˜¯æµè§ˆå™¨çª—å£çš„å®½åº¦ã€‚</p>
<p>æ‰€ä»¥åœ¨æ¡Œé¢ä½¿ç”¨å®½åº¦ï¼Œè€Œå¿˜è®°è®¾å¤‡å®½åº¦ã€‚æˆ‘ä»¬å°†çœ‹åˆ°ï¼Œç§»åŠ¨å¹³å°çš„æƒ…å†µæ›´åŠ æ··ä¹±ã€‚</p>
<h3 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h3><p>è¿™å°±æ˜¯æˆ‘ä»¬å¯¹æ¡Œé¢æµè§ˆå™¨è¡Œä¸ºçš„æ¢ç´¢ã€‚æœ¬ç³»åˆ—çš„ç¬¬äºŒéƒ¨åˆ†å°†è¿™äº›æ¦‚å¿µç§»æ¤åˆ°ç§»åŠ¨è®¾å¤‡ï¼Œå¹¶å¼ºè°ƒäº†ä¸æ¡Œé¢è®¾å¤‡çš„ä¸€äº›é‡è¦åŒºåˆ«ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://hemengting.xyz/2021/09/23/%E7%BF%BB%E8%AF%91-viewports%E7%9A%84%E6%95%85%E4%BA%8B-part-one/" data-id="ckuwtunhw000jl4ubfjfk5297" data-title="ç¿»è¯‘:viewportsçš„æ•…äº‹-ç¬¬ä¸€éƒ¨åˆ†" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/html-%E7%BF%BB%E8%AF%91/" rel="tag">html,ç¿»è¯‘</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-thisæ˜¯ä»€ä¹ˆ" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/19/this%E6%98%AF%E4%BB%80%E4%B9%88/" class="article-date">
  <time class="dt-published" datetime="2021-09-19T13:14:26.000Z" itemprop="datePublished">2021-09-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/19/this%E6%98%AF%E4%BB%80%E4%B9%88/">thisæ˜¯ä»€ä¹ˆ</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="thisæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#thisæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="thisæ˜¯ä»€ä¹ˆï¼Ÿ"></a>thisæ˜¯ä»€ä¹ˆï¼Ÿ</h1><p>thisæ˜¯å‡½æ•°å†…éƒ¨çš„ä¸€ä¸ªå¯¹è±¡ï¼Œå¼•ç”¨çš„æ˜¯æŠŠå‡½æ•°å½“æˆ<strong>æ–¹æ³•</strong>çš„<strong>ä¸Šä¸‹æ–‡</strong>å¯¹è±¡ã€‚</p>
<ul>
<li><p>åœ¨æ ‡å‡†å‡½æ•°ä¸­ï¼Œthiså¼•ç”¨çš„æ˜¯æŠŠå‡½æ•°å½“æˆæ–¹æ³•<strong>è°ƒç”¨</strong>çš„ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚</p>
</li>
<li><p>åœ¨ç®­å¤´å‡½æ•°ä¸­ï¼Œthiså¼•ç”¨çš„æ˜¯<strong>å®šä¹‰</strong>ç®­å¤´å‡½æ•°çš„ä¸Šä¸‹æ–‡ã€‚</p>
</li>
</ul>
<p>é‚£ä¹ˆä¸Šä¸‹æ–‡å¯¹è±¡æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>ä¸Šä¸‹æ–‡æ˜¯<strong>æ‰§è¡Œ</strong>ä¸Šä¸‹æ–‡çš„ç®€ç§°ï¼Œä¸»è¦æœ‰å…¨å±€ä¸Šä¸‹æ–‡å’Œå±€éƒ¨ä¸Šä¸‹æ–‡ä¸¤ç§ï¼Œæ¯ä¸ªå‡½æ•°è°ƒç”¨éƒ½æœ‰è‡ªå·±çš„ä¸Šä¸‹æ–‡ã€‚å˜é‡æˆ–å‡½æ•°çš„ä¸Šä¸‹æ–‡å†³å®šäº†å®ƒä»¬å¯ä»¥è®¿é—®å“ªäº›æ•°æ®ï¼Œä»¥åŠä»–ä»¬çš„è¡Œä¸ºã€‚æ¯ä¸ªä¸Šä¸‹æ–‡éƒ½æœ‰ä¸€ä¸ªå…³è”çš„<strong>å˜é‡å¯¹è±¡</strong>ï¼Œè€Œè¿™ä¸ªä¸Šä¸‹æ–‡ä¸­å®šä¹‰çš„æ‰€æœ‰å˜é‡å’Œå‡½æ•°éƒ½å­˜åœ¨äºè¿™ä¸ªå¯¹è±¡ä¸Šã€‚</p>
<p>æˆ‘çš„ç†è§£å‘¢å°±æ˜¯ï¼Œä½œç”¨åŸŸé“¾çš„æ•°æ®ç»“æ„ç±»ä¼¼äºæ ˆï¼Œæ¯ä¸ªå‡½æ•°éƒ½æœ‰è‡ªå·±çš„ä½œç”¨åŸŸé“¾ï¼Œ<strong>å®šä¹‰</strong>æ—¶åˆå§‹åŒ–ï¼Œé¢„è£…è½½å…¨å±€å˜é‡ã€‚å‡½æ•°<strong>è°ƒç”¨</strong>æ—¶ï¼Œåˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œæ›´æ–°ä½œç”¨åŸŸé“¾ã€‚</p>
<p>å…ˆæ¥çœ‹ä¸€ä¸‹æ ‡å‡†å‡½æ•°ï¼Œæˆ‘ä»¬å¸¸å†™çš„æ˜¯ä¸‹é¢è¿™ç§æ–¹å¼ï¼ŒAæ˜¯å…¨å±€ä¸Šä¸‹æ–‡ä¸­çš„å¯¹è±¡ï¼Œ<code>sayHello</code>æ˜¯ä½œä¸ºAçš„æ–¹æ³•è°ƒç”¨çš„ï¼Œå› æ­¤<code>this</code>å¼•ç”¨çš„æ˜¯Aï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> A = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;A&#x27;</span>,</span><br><span class="line">    <span class="attr">sayHello</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="built_in">this</span>.name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">A.sayHello() <span class="comment">// A</span></span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆå¦‚æœåœ¨Aä¸­æ‰§è¡Œå‘¢ï¼Ÿå› ä¸ºAå®šä¹‰æ˜¯åœ¨å…¨å±€ä½œç”¨åŸŸä¸­ï¼Œæ‰€ä»¥å…¶å®å’Œç›´æ¥åœ¨å…¨å±€æ‰§è¡Œä¸€æ ·ï¼Œç«‹å³æ‰§è¡Œå‡½æ•°çš„thiså¼•ç”¨çš„æ˜¯Windowï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> A = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;A&#x27;</span>,</span><br><span class="line">    <span class="attr">sayHello</span>: (<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="built_in">this</span>) <span class="comment">// Window</span></span><br><span class="line">    &#125;)()</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±ä¸éš¾ç†è§£ç®­å¤´å‡½æ•°ä¸­thisçš„å¼•ç”¨äº†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> A = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;A&#x27;</span>,</span><br><span class="line">    <span class="attr">sayHello</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="built_in">this</span>.name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">A.sayHello() <span class="comment">// Cannot read property &#x27;name&#x27; of undefined</span></span><br></pre></td></tr></table></figure>

<p>åœ¨æ ‡å‡†å‡½æ•°ä¸­thiså’Œargumentsæ˜¯åœ¨è¢«è°ƒç”¨æ—¶åˆ›å»ºçš„ï¼Œåœ¨é—­åŒ…ä¸­ä½¿ç”¨thisæ—¶ï¼Œå†…éƒ¨å‡½æ•°æ°¸è¿œä¸å¯èƒ½ç›´æ¥è®¿é—®å¤–éƒ¨å‡½æ•°çš„thiså’Œargumentså˜é‡ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> A = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;A&#x27;</span>,</span><br><span class="line">    <span class="attr">sayHello</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="built_in">this</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">A.sayHello()() <span class="comment">// Window</span></span><br></pre></td></tr></table></figure>

<p>å¯ä»¥é€šè¿‡æŠŠthisä¿å­˜åˆ°é—­åŒ…å¯ä»¥è®¿é—®çš„å¦ä¸€ä¸ªå˜é‡æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œç®­å¤´å‡½æ•°æ˜¯åœ¨æ ‡å‡†å‡½æ•°ä¸­å®šä¹‰å¹¶è¿”å›çš„ï¼Œthiså¼•ç”¨çš„æ˜¯<code>A.sayHello</code>çš„ä¸Šä¸‹æ–‡:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> A = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;A&#x27;</span>,</span><br><span class="line">    <span class="attr">sayHello</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="built_in">this</span>.name)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">A.sayHello()() <span class="comment">// A</span></span><br></pre></td></tr></table></figure>

<p>åœ¨å‡½æ•°å®šä¹‰é˜¶æ®µå‘¢ï¼Œå°±æ˜¯Windowï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> A = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;A&#x27;</span>,</span><br><span class="line">    <span class="attr">sayHello</span>: (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        (<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="built_in">this</span>) <span class="comment">// Window</span></span><br><span class="line">        &#125;)()</span><br><span class="line">    &#125;)()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://hemengting.xyz/2021/09/19/this%E6%98%AF%E4%BB%80%E4%B9%88/" data-id="ckuwtunhr0006l4ubg5ne202b" data-title="thisæ˜¯ä»€ä¹ˆ" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-webpackå…¥é—¨å…­ã€æ€§èƒ½è°ƒä¼˜" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/10/webpack%E5%85%A5%E9%97%A8%E5%85%AD%E3%80%81%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/" class="article-date">
  <time class="dt-published" datetime="2021-09-10T14:40:22.000Z" itemprop="datePublished">2021-09-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/10/webpack%E5%85%A5%E9%97%A8%E5%85%AD%E3%80%81%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/">webpackå…¥é—¨å…­ã€æ€§èƒ½è°ƒä¼˜</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="webpackæ€§èƒ½è°ƒä¼˜"><a href="#webpackæ€§èƒ½è°ƒä¼˜" class="headerlink" title="webpackæ€§èƒ½è°ƒä¼˜"></a><code>webpack</code>æ€§èƒ½è°ƒä¼˜</h1><h4 id="å­¦ä¹ ç›®æ ‡"><a href="#å­¦ä¹ ç›®æ ‡" class="headerlink" title="å­¦ä¹ ç›®æ ‡"></a>å­¦ä¹ ç›®æ ‡</h4><ul>
<li>æ‰“åŒ…ç»“æœä¼˜åŒ–</li>
<li>æ„å»ºè¿‡ç¨‹ä¼˜åŒ–</li>
<li>tree-shaking</li>
</ul>
<p><code>webpack</code>åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä¼šè‡ªåŠ¨å‹ç¼©ä»£ç </p>
<h4 id="é¢„åˆ¶terser-pluginï¼šå®ç°æ’ä»¶å®šåˆ¶"><a href="#é¢„åˆ¶terser-pluginï¼šå®ç°æ’ä»¶å®šåˆ¶" class="headerlink" title="é¢„åˆ¶terser pluginï¼šå®ç°æ’ä»¶å®šåˆ¶"></a>é¢„åˆ¶<code>terser plugin</code>ï¼šå®ç°æ’ä»¶å®šåˆ¶</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TerserPlugin = <span class="built_in">require</span>(<span class="string">&#x27;terser-webpack-plugin&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>é…ç½®ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">optimization: &#123;</span><br><span class="line">       <span class="attr">minimizer</span>: [<span class="keyword">new</span> TerserPlugin(&#123;</span><br><span class="line">           <span class="comment">// ä½¿ç”¨ç¼“å­˜ï¼ŒåŠ å¿«æ„å»ºé€Ÿåº¦</span></span><br><span class="line">           <span class="attr">cache</span>: <span class="literal">true</span>,</span><br><span class="line">           <span class="attr">parallel</span>: <span class="literal">true</span>,</span><br><span class="line">           <span class="comment">// æ‰“åŒ…å¤šçº¿ç¨‹</span></span><br><span class="line">           <span class="attr">TerserOptions</span>: &#123;</span><br><span class="line">               <span class="attr">compress</span>: &#123;</span><br><span class="line">                   <span class="comment">// ç§»é™¤æ— ç”¨ä»£ç ,debuggerã€consoleç­‰</span></span><br><span class="line">                   <span class="attr">unused</span>: <span class="literal">true</span>,</span><br><span class="line">                   <span class="attr">drop_debugger</span>: <span class="literal">true</span>,</span><br><span class="line">                   <span class="attr">drop_console</span>: <span class="literal">true</span>,</span><br><span class="line">                   <span class="attr">dead_code</span>: <span class="literal">true</span></span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;)]</span><br><span class="line">   &#125;,</span><br></pre></td></tr></table></figure>

<p>æ‰“åŒ…ç»“æœå¯è§†åŒ–åˆ†æï¼š<code>webpack.bundle-analyzer</code>ï¼Œå¯ä»¥çœ‹åˆ°å“ªä¸€éƒ¨åˆ†å çš„ä½“ç§¯æ›´å¤§</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack-bundle-analyzer</span><br></pre></td></tr></table></figure>

<p>é…ç½®ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> BundleAnalyzerPlugin()</span><br></pre></td></tr></table></figure>

<p>æŠ¥é”™</p>
<blockquote>
<p>[webpack-cli] TypeError: BundleAnalyzerPlugin is not a constructor</p>
</blockquote>
<p>è§£å†³ï¼šè§£æ„èµ‹å€¼å¼•ç”¨</p>
<h4 id="å…¶ä»–è°ƒä¼˜æ–¹å¼ï¼š"><a href="#å…¶ä»–è°ƒä¼˜æ–¹å¼ï¼š" class="headerlink" title="å…¶ä»–è°ƒä¼˜æ–¹å¼ï¼š"></a>å…¶ä»–è°ƒä¼˜æ–¹å¼ï¼š</h4><ul>
<li>å‡å°‘è§£æï¼šé…ç½®ä¸è§£æçš„æ–‡ä»¶ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">noParse: /node_modules\/(jquery\.js)/,</span><br></pre></td></tr></table></figure>

<ul>
<li>å‡å°‘æŸ¥æ‰¾ï¼šincludeåªæ‰“åŒ…æŸäº›æ–‡ä»¶</li>
</ul>
<ul>
<li>åˆ©ç”¨å¤šçº¿ç¨‹æé«˜æ„å»ºé€Ÿåº¦ï¼Œå¹¶å‘æ‰§è¡Œå­è¿›ç¨‹ï¼š</li>
</ul>
<ol>
<li><code>thread-loader</code>æŠŠloaderæ”¾åœ¨workerçº¿ç¨‹æ± é‡Œï¼Œå¿…é¡»æ”¾åœ¨æ‰€æœ‰<code>loader</code>ä¹‹å‰</li>
<li><code>HappyPack</code>ï¼šå¤šè¿›ç¨‹</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ¹æ®cpuæ•°é‡åˆ›å»ºçº¿ç¨‹æ± </span></span><br><span class="line"><span class="keyword">const</span> happyThreadPool = HappyPack.ThreadPool(&#123;<span class="attr">size</span>: os.cpus().length&#125;)</span><br><span class="line"><span class="comment">// url-loader file-loaderä¸æ”¯æŒhappypack</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>é¢„ç¼–è¯‘ï¼š</p>
</li>
<li><p>ç¼“å­˜ï¼šfast-sass-loaderå¹¶è¡Œå¤„ç†sassæ–‡ä»¶</p>
</li>
</ul>
<ul>
<li>source-map</li>
</ul>
<h4 id="tree-shaking"><a href="#tree-shaking" class="headerlink" title="tree-shaking"></a>tree-shaking</h4><p>æ¶ˆé™¤æ— ç”¨JavaScriptä»£ç <code>DCE</code>ï¼Œ ä¾‹å¦‚ï¼šå¼•ç”¨æœªæ‰§è¡Œçš„æ¨¡å—</p>
<p>developmentï¼šå»æ‰æ— ç”¨å¼•ç”¨</p>
<p>run buildï¼šç›´æ¥å»æ‰</p>
<p>æ€»ç»“ï¼š<code>webpack</code>æ˜¯ä»€ä¹ˆ</p>
<ul>
<li><p>å‰ç«¯å‘å±•çš„äº§ç‰©</p>
</li>
<li><p>æ¨¡å—åŒ–æ‰“åŒ…æ–¹æ¡ˆ</p>
</li>
<li><p>å·¥ç¨‹åŒ–æ–¹æ¡ˆ ï¼Œä¾‹å¦‚<code>create-react-app</code>ä¹Ÿæ˜¯åŸºäº<code>webpack</code></p>
</li>
</ul>
<p>è¡¥å……ï¼šäº†è§£è¿›ç¨‹ä¸çº¿ç¨‹çš„æ¦‚å¿µï¼Œ<code>webpack</code>ä¼˜åŒ–æ˜¯ä½“ç°å·¥ä½œèƒ½åŠ›çš„åœ°æ–¹</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://hemengting.xyz/2021/09/10/webpack%E5%85%A5%E9%97%A8%E5%85%AD%E3%80%81%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98/" data-id="ckuwtunhs000bl4ubea160ny7" data-title="webpackå…¥é—¨å…­ã€æ€§èƒ½è°ƒä¼˜" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-webpackå…¥é—¨äº”ã€webpackæ„å»ºå·¥ç¨‹" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/10/webpack%E5%85%A5%E9%97%A8%E4%BA%94%E3%80%81webpack%E6%9E%84%E5%BB%BA%E5%B7%A5%E7%A8%8B/" class="article-date">
  <time class="dt-published" datetime="2021-09-10T14:05:39.000Z" itemprop="datePublished">2021-09-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/10/webpack%E5%85%A5%E9%97%A8%E4%BA%94%E3%80%81webpack%E6%9E%84%E5%BB%BA%E5%B7%A5%E7%A8%8B/">webpackå…¥é—¨äº”ã€webpackæ„å»ºå·¥ç¨‹</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="webpackæ„å»ºå·¥ç¨‹"><a href="#webpackæ„å»ºå·¥ç¨‹" class="headerlink" title="webpackæ„å»ºå·¥ç¨‹"></a><code>webpack</code>æ„å»ºå·¥ç¨‹</h1><h4 id="å­¦ä¹ ç›®æ ‡"><a href="#å­¦ä¹ ç›®æ ‡" class="headerlink" title="å­¦ä¹ ç›®æ ‡"></a>å­¦ä¹ ç›®æ ‡</h4><ul>
<li>ä½¿ç”¨<code>webpack</code>æ„å»ºçœŸå®<code>react</code>å·¥ç¨‹</li>
<li>æŒæ¡<code>babel</code>çš„ç”¨æ³•ï¼Œç†è§£<code>babel</code>åŸç†</li>
<li>æŒæ¡é«˜é¢‘<code>loader</code>å’Œ<code>plugin</code>çš„ç”¨æ³•</li>
<li>æŒæ¡ç”Ÿäº§çº§åˆ«çš„<code>webpack</code>é…ç½®æ–¹æ³•</li>
</ul>
<h4 id="å‡†å¤‡å·¥ä½œï¼š"><a href="#å‡†å¤‡å·¥ä½œï¼š" class="headerlink" title="å‡†å¤‡å·¥ä½œï¼š"></a>å‡†å¤‡å·¥ä½œï¼š</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mkdir learn<span class="literal">-webpack</span></span><br><span class="line"><span class="built_in">cd</span> learn<span class="literal">-webpack</span></span><br><span class="line">npm init</span><br><span class="line">npm init <span class="literal">-y</span> // æŠŠæ‰€æœ‰é¢„ç½®é¡¹è®¾ç½®ä¸ºnpmé»˜è®¤</span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">npm install react react<span class="literal">-dom</span></span><br><span class="line">npm install webpack webpack<span class="literal">-cli</span> <span class="literal">-d</span></span><br></pre></td></tr></table></figure>

<h4 id="é¡¹ç›®æ–‡ä»¶ï¼š"><a href="#é¡¹ç›®æ–‡ä»¶ï¼š" class="headerlink" title="é¡¹ç›®æ–‡ä»¶ï¼š"></a>é¡¹ç›®æ–‡ä»¶ï¼š</h4><p><code>App.jsx</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> ReactDom <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; isNull, isZero &#125; <span class="keyword">from</span> <span class="string">&#x27;./utils&#x27;</span></span><br><span class="line"></span><br><span class="line">isNull(&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>webpackå­¦ä¹ <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App</span><br><span class="line">ReactDom.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span>/&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;app&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p><code>index.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>React Webpackæµ‹è¯•<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>webpack</code>è¯»ä¸æ‡‚<code>ES6</code>è¯­æ³•ï¼Œä¹Ÿæ— æ³•å¤„ç†<code>html</code>æ–‡ä»¶ã€‚</p>
<h4 id="babelï¼š"><a href="#babelï¼š" class="headerlink" title="babelï¼š"></a>babelï¼š</h4><p>æŠŠé«˜ç‰ˆæœ¬ä»£ç ç¼–è¯‘æˆä½ç‰ˆæœ¬ä»£ç </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @babel/core @babel/cli -g</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">babel test.js --presets=@babel/preset-env</span><br></pre></td></tr></table></figure>

<p><code>--presets=@babel/preset-env</code>æ˜¯é…ç½®å‚æ•°ï¼ŒæŒ‡å®šè½¬æ¢è§„åˆ™ã€‚<code>presets-env</code>å¯ä»¥æŠŠé«˜ç‰ˆæœ¬ä»£ç è½¬æ¢ä¸ºä½ç‰ˆæœ¬ã€‚å†™åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼š</p>
<p><code>package.json</code>æˆ–è€…<code>.babelrc</code>æ–‡ä»¶(ä¼˜å…ˆæŸ¥è¯¢)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;babel&quot;</span>: &#123;</span><br><span class="line">	<span class="string">&quot;presets&quot;</span>: [<span class="string">&quot;@babel/presets-env&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="åœ¨webpackä¸­ä½¿ç”¨babel"><a href="#åœ¨webpackä¸­ä½¿ç”¨babel" class="headerlink" title="åœ¨webpackä¸­ä½¿ç”¨babel"></a>åœ¨<code>webpack</code>ä¸­ä½¿ç”¨<code>babel</code></h4><p><code>webpack.config.js</code>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.jsx?/</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>, <span class="comment">// ä¸å¯¹node_moduleè¿›è¡Œç¼–è¯‘</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®‰è£…loaderå’Œè§„åˆ™ï¼šè§£å†³ä»£ç è½¬è¯‘é—®é¢˜ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-loader</span><br><span class="line">npm install @babel/preset-env @babel/preset-react</span><br></pre></td></tr></table></figure>

<p>å¡«å†™è§„åˆ™ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">options: &#123;</span><br><span class="line">    <span class="attr">babelrc</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">presets</span>: [</span><br><span class="line">        <span class="built_in">require</span>.resolve(<span class="string">&#x27;@babel/preset-react&#x27;</span>),</span><br><span class="line">        <span class="comment">// è½¬ä¹‰jsx</span></span><br><span class="line">        [<span class="built_in">require</span>.resolve(<span class="string">&#x27;@babel/preset-env&#x27;</span>, &#123;<span class="attr">modules</span>: <span class="literal">false</span>&#125;)]</span><br><span class="line">        <span class="comment">// è½¬ä¹‰ES6ï¼Œwebpackå¯ä»¥è¯†åˆ«importè¯­æ³•</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">cacheDirectory</span>: <span class="literal">true</span>, <span class="comment">// æ˜¯å¦å¯¹è½¬è¯‘ç»“æœåšç¼“å­˜</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="htmlæ–‡ä»¶å¤„ç†ï¼šplugin"><a href="#htmlæ–‡ä»¶å¤„ç†ï¼šplugin" class="headerlink" title="htmlæ–‡ä»¶å¤„ç†ï¼šplugin"></a><code>html</code>æ–‡ä»¶å¤„ç†ï¼š<code>plugin</code></h4><p><code>plugin</code>å®ç°èŠ‚ç‚¹å±‚é¢çš„å¤„ç†ï¼Œä»¥æ„é€ å‡½æ•°çš„å½¢å¼å­˜åœ¨</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install html-webpack-plugin -d</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebPackPlugin(&#123;</span><br><span class="line">            <span class="attr">template</span>: path.join(__dirname, <span class="string">&#x27;src/index.html&#x27;</span>),</span><br><span class="line">            <span class="comment">// éœ€è¦è¢«å¤„ç†çš„æ–‡ä»¶çš„è·¯å¾„</span></span><br><span class="line">            <span class="attr">filename</span>: <span class="string">&#x27;index.html&#x27;</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>

<p>å…¥å£æ–‡ä»¶<code>index.jsx</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import App from &#x27;./App&#x27;</span><br></pre></td></tr></table></figure>

<p>importçœç•¥æ–‡ä»¶åç¼€ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">resolve: &#123;</span><br><span class="line">       <span class="attr">extensions</span>: [<span class="string">&#x27;.wasm&#x27;</span>, <span class="string">&#x27;.mjs&#x27;</span>, <span class="string">&#x27;.js&#x27;</span>, <span class="string">&#x27;.jsx&#x27;</span>, <span class="string">&#x27;json&#x27;</span>]</span><br><span class="line">&#125;,</span><br><span class="line">    <span class="attr">entry</span>: path.resolve(__dirname, <span class="string">&#x27;src/index.jsx&#x27;</span>), <span class="comment">// å…¥å£æ–‡ä»¶</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ERROR in ./src/index.html 1:0<br>Module parse failed: Unexpected token (1:0)<br>You may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See <a target="_blank" rel="noopener" href="https://webpack.js.org/concepts#loaders">https://webpack.js.org/concepts#loaders</a></p>
<blockquote>
<!DOCTYPE html>
<p>| <html lang="en"><br>| <head></p>
</blockquote>
<p>webpack 5.52.0 compiled with 1 error in 93 ms</p>
</blockquote>
<p>babelä¸babel-loaderç‰ˆæœ¬åº”è¯¥ç›¸åŒ¹é…<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/babel-loader">https://www.npmjs.com/package/babel-loader</a></p>
<h4 id="æ‰“åŒ…"><a href="#æ‰“åŒ…" class="headerlink" title="æ‰“åŒ…"></a>æ‰“åŒ…</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">webpack<span class="literal">-dev</span><span class="literal">-server</span> -<span class="literal">-config</span> // æŒ‡å®šè¯»å–çš„configæ–‡ä»¶,æ¯”å¦‚webpack.config.dev.js</span><br><span class="line">webpack<span class="literal">-dev</span><span class="literal">-server</span> -<span class="literal">-open</span> // æ‰“å¼€æµè§ˆå™¨</span><br></pre></td></tr></table></figure>

<p>è‡ªå®šä¹‰å‘½ä»¤ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;build&quot;</span>: <span class="string">&quot;webpack --mode production&quot;</span>, <span class="comment">// æ‰“åŒ…</span></span><br><span class="line">    <span class="string">&quot;start&quot;</span>: <span class="string">&quot;webpack-dev-server --mode development --open&quot;</span> <span class="comment">// é¢„è§ˆ</span></span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure>

<p><code>HMR</code>çƒ­æ›´æ–°ï¼ˆçƒ­æ›¿æ¢ï¼‰ï¼Œ åœ¨ä¸åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹æ›´æ–°ä¿®æ”¹éƒ¨åˆ†ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">	<span class="attr">hot</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="attr">Plugins</span>: [</span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">new</span> webpack.HotModuleReplacementPlugin()</span><br><span class="line">    ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><code>index.jsx</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">    <span class="built_in">module</span>.hot.accept(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;çƒ­æ›¿æ¢å‡ºé”™&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://hemengting.xyz/2021/09/10/webpack%E5%85%A5%E9%97%A8%E4%BA%94%E3%80%81webpack%E6%9E%84%E5%BB%BA%E5%B7%A5%E7%A8%8B/" data-id="ckuwtunhs0009l4ubd2d42fbw" data-title="webpackå…¥é—¨äº”ã€webpackæ„å»ºå·¥ç¨‹" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-webpackå…¥é—¨å››ã€webpackæ ¸å¿ƒç‰¹æ€§" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/10/webpack%E5%85%A5%E9%97%A8%E5%9B%9B%E3%80%81webpack%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7/" class="article-date">
  <time class="dt-published" datetime="2021-09-10T13:28:46.000Z" itemprop="datePublished">2021-09-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/10/webpack%E5%85%A5%E9%97%A8%E5%9B%9B%E3%80%81webpack%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7/">webpackå…¥é—¨å››ã€webpackæ ¸å¿ƒç‰¹æ€§</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="webpackæ ¸å¿ƒç‰¹æ€§"><a href="#webpackæ ¸å¿ƒç‰¹æ€§" class="headerlink" title="webpackæ ¸å¿ƒç‰¹æ€§"></a>webpackæ ¸å¿ƒç‰¹æ€§</h1><h4 id="å­¦ä¹ ç›®æ ‡"><a href="#å­¦ä¹ ç›®æ ‡" class="headerlink" title="å­¦ä¹ ç›®æ ‡"></a>å­¦ä¹ ç›®æ ‡</h4><ul>
<li>ä½¿ç”¨webpackæ„å»ºç®€å•å·¥ç¨‹</li>
<li>äº†è§£webpacké…ç½®æ–‡ä»¶</li>
<li>æŒæ¡â€œä¸€åˆ‡çš†æ¨¡å—ä¸loadersâ€çš„æ€æƒ³</li>
<li>ç†è§£webpackä¸­çš„â€œå…³é”®äººç‰©â€â€”å…¥å£æ–‡ä»¶ã€å‡ºå£æ–‡ä»¶ã€loadersã€plugins</li>
</ul>
<p><code>index.html</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>React Webpackæµ‹è¯•<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">src</span>=<span class="string">&#x27;/dist/bunle.js&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>moduleLog.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">document</span>.write(<span class="string">&#x27;moduleLog is loaded&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>src/index.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> moduleLog <span class="keyword">from</span> <span class="string">&#x27;../moduleLog&#x27;</span></span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">&#x27;å…¥å£js is loaded&#x27;</span>);</span><br><span class="line">moduleLog();</span><br></pre></td></tr></table></figure>

<h4 id="å®‰è£…webpackå’Œwebpack-cli"><a href="#å®‰è£…webpackå’Œwebpack-cli" class="headerlink" title="å®‰è£…webpackå’Œwebpack-cli:"></a>å®‰è£…webpackå’Œwebpack-cli:</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack</span><br><span class="line">npm install webpack-cli -g</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æŠ¥é”™ï¼šæ— æ³•å°†â€œWEBPACKâ€é¡¹è¯†åˆ«ä¸º CMDLETã€å‡½æ•°ã€è„šæœ¬æ–‡ä»¶æˆ–å¯è¿è¡Œç¨‹åºçš„åç§°</p>
</blockquote>
<p>å‡ºç°è¿™ä¸ªé”™è¯¯çš„åŸå› æ˜¯ï¼šwindows10ä¸­ï¼Œä½ çš„webpackæ˜¯å±€éƒ¨å®‰è£…çš„ï¼Œå¹¶æ²¡æœ‰åŠ å…¥åˆ°ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­ï¼Œæ‰€ä»¥æ§åˆ¶å°æ‰¾ä¸åˆ°webpackå‘½ä»¤ï¼Œæœ‰ä»¥ä¸‹æ–¹æ³•å¯ä»¥è§£å†³ï¼š</p>
<ul>
<li>æ‰¾åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„<strong>package.json</strong>æ–‡ä»¶ï¼Œé…ç½®<code>&#39;scripts&#39;</code>è¿™ä¸ªé€‰é¡¹ï¼Œé…ç½®åŠ ä¸Š<code>&quot;build&quot;ï¼š&quot;webpack&quot;</code>ï¼Œç„¶åè¿è¡Œ<code>npm run build</code></li>
<li>å…¨å±€å®‰è£…webpack</li>
</ul>
<p>é»˜è®¤å…¥å£æ–‡ä»¶ï¼šsrc/index.js </p>
<p>å‡ºå£ï¼šdist/main.js</p>
<h4 id="è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼š"><a href="#è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼š" class="headerlink" title="è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼š"></a>è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼š</h4><p><code>webpack.config.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">entry</span>: <span class="string">&#x27;./app.js&#x27;</span>, <span class="comment">// ä¿®æ”¹å…¥å£æ–‡ä»¶</span></span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">path</span>: path.join(__dirname, <span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&#x27;bundle.js&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è­¦å‘Šï¼šWARNING in configuration<br>The â€˜modeâ€™ option has not been set, webpack will fallback to â€˜productionâ€™<br>for this value.<br>Set â€˜modeâ€™ option to â€˜developmentâ€™ or â€˜productionâ€™ to enable defaults for<br>each environment.</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mode: &#x27;development&#x27;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯æ¯æ¬¡ä¿®æ”¹éƒ½è¦ä¿å­˜ã€æ‰“åŒ…å¾ˆéº»çƒ¦ï¼Œæœ‰æ²¡æœ‰è‡ªåŠ¨çš„æ–¹æ³•å‘¢ï¼Ÿ</p>
<h4 id="è‡ªåŠ¨æ‰“åŒ…å·¥å…·ï¼šwebpack-dev-server"><a href="#è‡ªåŠ¨æ‰“åŒ…å·¥å…·ï¼šwebpack-dev-server" class="headerlink" title="è‡ªåŠ¨æ‰“åŒ…å·¥å…·ï¼šwebpack-dev-server"></a>è‡ªåŠ¨æ‰“åŒ…å·¥å…·ï¼šwebpack-dev-server</h4><p>å¯åŠ¨<code>webpack-dev-server</code>å¯ä»¥ç›‘å¬å·¥ç¨‹ç›®å½•æ–‡ä»¶çš„æ”¹åŠ¨ï¼Œä¿®æ”¹æºæ–‡ä»¶å¹¶å†æ¬¡ä¿å­˜å¯ä»¥å®ç°åŠ¨æ€å®æ—¶æ‰“åŒ…ï¼Œè‡ªåŠ¨åˆ·æ–°æµè§ˆå™¨ã€‚</p>
<p>ä¸ç®¡cliè¿˜æ˜¯webpack-dev-serveréƒ½æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸€ç§æ–¹æ³•æ˜¯å…¨å±€å®‰è£…ï¼Œæˆ–è€…è¿›å…¥node_module/.bin/serveræ‰§è¡Œ</p>
<blockquote>
<p>æŠ¥é”™ï¼š.\webpack-dev-server : æ— æ³•åŠ è½½æ–‡ä»¶ C:\Users\hh\github\learnwebpack\node_<br>modules.bin\webpack-dev-server.ps1ï¼Œå› ä¸ºåœ¨æ­¤ç³»ç»Ÿä¸Šç¦æ­¢è¿è¡Œè„šæœ¬ã€‚æœ‰å…³è¯¦ç»†<br>ä¿¡æ¯ï¼Œè¯·å‚é˜… https:/go.microsoft.com/fwlink/?LinkID=135170 ä¸­çš„ about_Exe<br>cution_Policiesã€‚</p>
</blockquote>
<ol>
<li>ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œpowershell</li>
<li>è¾“å…¥set-executionpolicy remotesignedï¼Œå›è½¦</li>
<li>è¾“å…¥yes</li>
</ol>
<p>æŒ‡å®šæœ¬åœ°æœåŠ¡ç«¯å£ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">devServer: &#123;</span><br><span class="line">	<span class="attr">port</span>: <span class="number">3000</span>, <span class="comment">// æœåŠ¡ç«¯å£</span></span><br><span class="line">	<span class="attr">publicPath</span>: <span class="string">&#x27;/dist&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶åˆ é™¤bundle.jsä¾ç„¶å¯ä»¥è¿è¡Œï¼Œè¯´æ˜åªåœ¨å†…å­˜ä¸­ç”Ÿæˆäº†ä¸€ä¸ªbundle.jsï¼Œå½“æµè§ˆå™¨å‘å‡ºè¯·æ±‚æ—¶æ‰ä¼šè¿è¡Œã€‚</p>
<p>æ‰€æœ‰èµ„æºï¼ˆå›¾ç‰‡ã€cssç­‰ï¼‰éƒ½æ˜¯æ¨¡å—</p>
<h4 id="æ–‡ä»¶ç¼–è¯‘ï¼šloader"><a href="#æ–‡ä»¶ç¼–è¯‘ï¼šloader" class="headerlink" title="æ–‡ä»¶ç¼–è¯‘ï¼šloader"></a>æ–‡ä»¶ç¼–è¯‘ï¼šloader</h4><p>å®‰è£…css loaderå’Œstyle loader</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install css<span class="literal">-loader</span> -<span class="literal">-save</span><span class="literal">-dev</span></span><br><span class="line">npm install style<span class="literal">-loader</span> -<span class="literal">-save</span><span class="literal">-dev</span></span><br></pre></td></tr></table></figure>

<p>loaderæœ¬è´¨ä¸Šæ˜¯æ–‡ä»¶åŠ è½½å™¨</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">            <span class="string">&#x27;style-loader&#x27;</span>, <span class="comment">// åŠ è½½æ ·å¼</span></span><br><span class="line">            <span class="string">&#x27;css-loader&#x27;</span> <span class="comment">// ç¼–è¯‘cssæ–‡ä»¶ï¼Œæ³¨æ„é…ç½®é¡ºåºä¸åŠ è½½é¡ºåºç›¸å</span></span><br><span class="line">        ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="pluginsï¼š"><a href="#pluginsï¼š" class="headerlink" title="pluginsï¼š"></a>pluginsï¼š</h4><p>ç›‘å¬äº‹ä»¶ï¼Œæ”¹å˜æ–‡ä»¶æ‰“åŒ…è¾“å‡ºç»“æœï¼Œæ¯”å¦‚å‹ç¼©èµ„æºä½“ç§¯ï¼Œå»æ‰ä»£ç ä¸­çš„æ³¨é‡Šã€‚</p>
<p>ä¸¾ä¾‹ï¼šå¼•å…¥uglifyä¹‹å‰çš„æ‰“åŒ…ç»“æœï¼š<code>asset bundle.js 4.26 KiB [emitted] (name: main) </code></p>
<p>å®‰è£…ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install uglifyjs-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure>

<p>å¼•å…¥ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> UglifyJSPlugin = <span class="built_in">require</span>(<span class="string">&quot;uglifyjs-webpack-plugin&quot;</span>)</span><br><span class="line">...</span><br><span class="line"><span class="attr">Plugins</span>: [</span><br><span class="line">	<span class="keyword">new</span> UglifyJSPlugin()</span><br><span class="line">]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><code>asset bundle.js 1.82 KiB [emitted] (name: main)</code></p>
<p>ä»£ç ä½“ç§¯å‡å°äº†ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://hemengting.xyz/2021/09/10/webpack%E5%85%A5%E9%97%A8%E5%9B%9B%E3%80%81webpack%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7/" data-id="ckuwtunhu000el4ub1asmh7io" data-title="webpackå…¥é—¨å››ã€webpackæ ¸å¿ƒç‰¹æ€§" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-webpackå…¥é—¨ä¸‰ã€é…ç½®å¼€å‘ç¯å¢ƒ-npmä¸åŒ…ç®¡ç†å™¨" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/10/webpack%E5%85%A5%E9%97%A8%E4%B8%89%E3%80%81%E9%85%8D%E7%BD%AE%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83-npm%E4%B8%8E%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8/" class="article-date">
  <time class="dt-published" datetime="2021-09-10T12:58:27.000Z" itemprop="datePublished">2021-09-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/10/webpack%E5%85%A5%E9%97%A8%E4%B8%89%E3%80%81%E9%85%8D%E7%BD%AE%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83-npm%E4%B8%8E%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8/">webpackå…¥é—¨ä¸‰ã€é…ç½®å¼€å‘ç¯å¢ƒ-npmä¸åŒ…ç®¡ç†å™¨</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="é…ç½®å¼€å‘ç¯å¢ƒâ€”â€”npmä¸åŒ…ç®¡ç†å™¨"><a href="#é…ç½®å¼€å‘ç¯å¢ƒâ€”â€”npmä¸åŒ…ç®¡ç†å™¨" class="headerlink" title="é…ç½®å¼€å‘ç¯å¢ƒâ€”â€”npmä¸åŒ…ç®¡ç†å™¨"></a>é…ç½®å¼€å‘ç¯å¢ƒâ€”â€”<code>npm</code>ä¸åŒ…ç®¡ç†å™¨</h1><h4 id="å­¦ä¹ ç›®æ ‡"><a href="#å­¦ä¹ ç›®æ ‡" class="headerlink" title="å­¦ä¹ ç›®æ ‡"></a>å­¦ä¹ ç›®æ ‡</h4><ul>
<li>ç†è§£åŒ…ç®¡ç†å™¨</li>
<li>ç†Ÿæ‚‰<code>npm</code>æ ¸å¿ƒç‰¹æ€§</li>
<li>ç†è§£<code>npm</code>â€ä»“åº“â€œä¸â€ä¾èµ–â€œçš„æ¦‚å¿µ</li>
<li>ç†è§£<code>npm</code>â€è¯­ä¹‰åŒ–ç‰ˆæœ¬â€œ</li>
<li>æŒæ¡ä½¿ç”¨<code>npm</code>è‡ªå®šä¹‰å·¥ç¨‹è„šæœ¬çš„æ–¹æ³•</li>
</ul>
<h4 id="ä»€ä¹ˆæ˜¯åŒ…ç®¡ç†å™¨ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯åŒ…ç®¡ç†å™¨ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯åŒ…ç®¡ç†å™¨ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯åŒ…ç®¡ç†å™¨ï¼Ÿ</h4><p>ä½¿å¼€å‘è€…èƒ½å¤Ÿä¾¿æ·çš„ç®¡ç†ä»£ç å’Œåˆ†å‘ä»£ç çš„å·¥å…·</p>
<h6 id="npmä¾èµ–nodeç¯å¢ƒï¼Œå®‰è£…nodeä¼šè‡ªåŠ¨å®‰è£…npmï¼ŒæŸ¥çœ‹nodeç‰ˆæœ¬å’Œnpmç‰ˆæœ¬ï¼š"><a href="#npmä¾èµ–nodeç¯å¢ƒï¼Œå®‰è£…nodeä¼šè‡ªåŠ¨å®‰è£…npmï¼ŒæŸ¥çœ‹nodeç‰ˆæœ¬å’Œnpmç‰ˆæœ¬ï¼š" class="headerlink" title="npmä¾èµ–nodeç¯å¢ƒï¼Œå®‰è£…nodeä¼šè‡ªåŠ¨å®‰è£…npmï¼ŒæŸ¥çœ‹nodeç‰ˆæœ¬å’Œnpmç‰ˆæœ¬ï¼š"></a><code>npm</code>ä¾èµ–<code>node</code>ç¯å¢ƒï¼Œå®‰è£…<code>node</code>ä¼šè‡ªåŠ¨å®‰è£…<code>npm</code>ï¼ŒæŸ¥çœ‹<code>node</code>ç‰ˆæœ¬å’Œ<code>npm</code>ç‰ˆæœ¬ï¼š</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node -v // æŸ¥çœ‹nodeç‰ˆæœ¬</span><br><span class="line">npm -v // æŸ¥çœ‹npmç‰ˆæœ¬</span><br></pre></td></tr></table></figure>

<h6 id="åˆå§‹åŒ–å·¥ç¨‹ï¼š"><a href="#åˆå§‹åŒ–å·¥ç¨‹ï¼š" class="headerlink" title="åˆå§‹åŒ–å·¥ç¨‹ï¼š"></a>åˆå§‹åŒ–å·¥ç¨‹ï¼š</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm-init </span><br></pre></td></tr></table></figure>

<h6 id="package-jsonï¼š"><a href="#package-jsonï¼š" class="headerlink" title="package.jsonï¼š"></a><code>package.json</code>ï¼š</h6><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;learn-webpack&quot;</span>, <span class="comment">// åŒ…åç§°</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>, <span class="comment">// ç‰ˆæœ¬å·</span></span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;index.js&quot;</span>, <span class="comment">// æ‰§è¡Œå…¥å£</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>,</span><br><span class="line">  &#125;, <span class="comment">// è‡ªå®šä¹‰è„šæœ¬ï¼Œè‡ªåŠ¨åŒ–æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">  <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h6 id="è®¾ç½®å›½å†…é•œåƒï¼š"><a href="#è®¾ç½®å›½å†…é•œåƒï¼š" class="headerlink" title="è®¾ç½®å›½å†…é•œåƒï¼š"></a>è®¾ç½®å›½å†…é•œåƒï¼š</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org</span><br></pre></td></tr></table></figure>

<h6 id="å®‰è£…åŒ…ï¼š"><a href="#å®‰è£…åŒ…ï¼š" class="headerlink" title="å®‰è£…åŒ…ï¼š"></a>å®‰è£…åŒ…ï¼š</h6><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install lodash --save</span><br></pre></td></tr></table></figure>

<p><code>--save</code>æˆ–<code> -s</code>å°†ä¸‹è½½çš„åŒ…å†™å…¥<code>package.json</code>çš„<em>ç”Ÿäº§ç¯å¢ƒ</em>ä¸‹çš„ä¾èµ–<code>dependencies</code>ä¸­ï¼Œ<code>npm</code>5.0ç‰ˆæœ¬ä¹‹åé»˜è®¤<code>--save</code></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install jquary -<span class="literal">-save</span><span class="literal">-dev</span></span><br><span class="line"><span class="literal">-d</span></span><br></pre></td></tr></table></figure>

<p><code>--save-dev</code>æˆ–<code>-d</code>æ·»åŠ åˆ°<em>å¼€å‘ç¯å¢ƒ</em>ä¸‹çš„ä¾èµ–<code>devDepencies</code>ï¼Œä¸»è¦æ˜¯æ„å»ºå·¥å…·ï¼Œè´¨é‡æ£€æµ‹å·¥å…·æ¯”å¦‚<code>eslint</code>ç­‰æœ¬åœ°å¼€å‘ç”¨åˆ°çš„åŒ…ã€‚</p>
<p>é¡¹ç›®è¿ç§»æ—¶ï¼Œæ‰§è¡Œ<code>npm install</code>å³å¯å®‰è£…`å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒä¸‹çš„åŒ…ã€‚</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -<span class="literal">-only</span>=dev</span><br></pre></td></tr></table></figure>

<p>åªå®‰è£…å¼€å‘ç¯å¢ƒä¸‹çš„åŒ…</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --only=prod</span><br></pre></td></tr></table></figure>

<p>åªå®‰è£…ç”Ÿäº§ç¯å¢ƒä¸­çš„åŒ…ï¼Œç”±æ­¤å¯ä»¥å®ç°ç¯å¢ƒåŒºåˆ†ã€‚</p>
<h6 id="åˆ é™¤å¹¶é‡è£…"><a href="#åˆ é™¤å¹¶é‡è£…" class="headerlink" title="åˆ é™¤å¹¶é‡è£…"></a>åˆ é™¤å¹¶é‡è£…</h6><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">rm</span> <span class="literal">-rf</span> node_modules &amp;&amp; npm install</span><br></pre></td></tr></table></figure>

<h4 id="ç‰ˆæœ¬å·ï¼Œè¯­ä¹‰åŒ–ç‰ˆæœ¬"><a href="#ç‰ˆæœ¬å·ï¼Œè¯­ä¹‰åŒ–ç‰ˆæœ¬" class="headerlink" title="ç‰ˆæœ¬å·ï¼Œè¯­ä¹‰åŒ–ç‰ˆæœ¬"></a>ç‰ˆæœ¬å·ï¼Œè¯­ä¹‰åŒ–ç‰ˆæœ¬</h4><ul>
<li><p>^version: ä¸­ç‰ˆæœ¬å’Œå°ç‰ˆæœ¬</p>
<p>^1.0.1 -&gt; 1.x.x</p>
</li>
<li><p>~version: å°ç‰ˆæœ¬</p>
<p>~1.0.1 -&gt; 1.0.x</p>
<p>æ–¹ä¾¿æ¨é€å°çš„æ–°ç‰ˆæœ¬ï¼ˆfix bugç­‰)</p>
</li>
<li><p>versionï¼šå›ºå®šç‰¹å®šç‰ˆæœ¬</p>
</li>
</ul>
<h4 id="scriptsè‡ªå®šä¹‰å‘½ä»¤æ‰§è¡Œè„šæœ¬"><a href="#scriptsè‡ªå®šä¹‰å‘½ä»¤æ‰§è¡Œè„šæœ¬" class="headerlink" title="scriptsè‡ªå®šä¹‰å‘½ä»¤æ‰§è¡Œè„šæœ¬"></a>scriptsè‡ªå®šä¹‰å‘½ä»¤æ‰§è¡Œè„šæœ¬</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;    </span><br><span class="line">    <span class="attr">test</span>: <span class="string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">    <span class="attr">dev</span>: <span class="string">&quot;webpack-dev-sever&quot;</span><span class="comment">//å¯åŠ¨ewbpackæœåŠ¡	</span></span><br><span class="line">    <span class="attr">build</span>: <span class="string">&#x27;eslint ./src &amp;&amp; webpack&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="npm-installçš„è¿‡ç¨‹ï¼š"><a href="#npm-installçš„è¿‡ç¨‹ï¼š" class="headerlink" title="npm installçš„è¿‡ç¨‹ï¼š"></a><code>npm install</code>çš„è¿‡ç¨‹ï¼š</h4><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/5tmND0G_ZkYVR7Dmug0ugQ">https://mp.weixin.qq.com/s/5tmND0G_ZkYVR7Dmug0ugQ</a></p>
<ul>
<li>å¯»æ‰¾åŒ…ç‰ˆæœ¬ä¿¡æ¯æ–‡ä»¶<code>package.json</code>ï¼Œä¾ç…§å®ƒæ¥è¿›è¡Œå®‰è£…</li>
<li>æŸ¥<code>package.json</code>ä¸­çš„ä¾èµ–ï¼Œå¹¶æ£€æŸ¥é¡¹ç›®ä¸­å…¶ä»–ç‰ˆæœ¬ä¿¡æ¯æ–‡ä»¶ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æŒ‰ç…§<code>package.json</code>çš„ä¾èµ–è¿›è¡Œå®‰è£…ï¼Œå¹¶ç”Ÿæˆç‰ˆæœ¬ä¿¡æ¯æ–‡ä»¶</li>
<li>å¦‚æœå‘ç°äº†æ–°åŒ…ï¼Œå°±æ›´æ–°ç‰ˆæœ¬ä¿¡æ¯æ–‡ä»¶</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://hemengting.xyz/2021/09/10/webpack%E5%85%A5%E9%97%A8%E4%B8%89%E3%80%81%E9%85%8D%E7%BD%AE%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83-npm%E4%B8%8E%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8/" data-id="ckuwtunhq0004l4ub3d8m9s4m" data-title="webpackå…¥é—¨ä¸‰ã€é…ç½®å¼€å‘ç¯å¢ƒ-npmä¸åŒ…ç®¡ç†å™¨" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-for-of-ä¸-for-inçš„åŒºåˆ«" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/10/for-of-%E4%B8%8E-for-in%E7%9A%84%E5%8C%BA%E5%88%AB/" class="article-date">
  <time class="dt-published" datetime="2021-09-10T08:44:47.000Z" itemprop="datePublished">2021-09-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/09/10/for-of-%E4%B8%8E-for-in%E7%9A%84%E5%8C%BA%E5%88%AB/">for...of ä¸ for...inçš„åŒºåˆ«</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><code>for...of</code>å’Œ<code>for...in</code>çš„ä½œç”¨éƒ½æ˜¯è¿­ä»£ã€‚å®ƒä»¬ä¹‹é—´çš„ä¸»è¦åŒºåˆ«æ˜¯è¿­ä»£çš„å†…å®¹ã€‚</p>
<p><code>for...in</code>è¯­å¥ä»¥ä»»æ„é¡ºåºè¿­ä»£<strong>å¯¹è±¡</strong>çš„å¯æšä¸¾<strong>å±æ€§</strong>ï¼ŒåŒ…æ‹¬å®ä¾‹å±æ€§å’ŒåŸå‹å±æ€§ã€‚</p>
<p><code>for...of</code>è¯­å¥è¿­ä»£<strong>å¯è¿­ä»£å¯¹è±¡</strong>å®šä¹‰çš„è¦è¿­ä»£çš„<strong>å€¼</strong>ã€‚</p>
<p>é‚£ä¹ˆï¼Œå¯è¿­ä»£å¯¹è±¡æœ‰å“ªäº›å‘¢ï¼ŸåŒ…æ‹¬ï¼š<code>String</code>ï¼Œ<code>Array</code>ï¼Œ<code>array-like objects</code>ï¼Œ<code>TypedArray</code>ï¼Œ<code>Map</code>ï¼Œ<code>Set</code>ã€‚</p>
<p>æ³¨æ„Objectå®ä¾‹ä¸æ˜¯å¯è¿­ä»£å¯¹è±¡ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨<code>for...of</code>è¿­ä»£å®ƒçš„å€¼ï¼Œä½†å¯ä»¥ç”¨<code>for...in</code>æšä¸¾å®ƒçš„å±æ€§ã€‚</p>
<p>ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†<code>for...of</code>å¾ªç¯å’Œ<code>for...in</code>å¾ªç¯åº”ç”¨åœ¨æ•°ç»„ä¸Šçš„åŒºåˆ«ï¼š</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.prototype.objCustom = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="built_in">Array</span>.prototype.arrCustom = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> iterable = [<span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>];</span><br><span class="line">iterable.foo = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> iterable) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i); <span class="comment">// logs &quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;foo&quot;ï¼Œ &quot;arrCustom&quot;, &quot;objCustom&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> iterable) &#123;</span><br><span class="line">    <span class="keyword">if</span>(iterable.hasOwnProperty(i)) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i); <span class="comment">// logs &quot;0&quot;, &quot;1&quot;, &quot;2&quot;, &quot;foo&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">of</span> iterable) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i); <span class="comment">// logs 3, 5, 7</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥åœ°çœ‹ä¸€ä¸‹ä¸Šé¢çš„ä»£ç ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.prototype.objCustom = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="built_in">Array</span>.prototype.arrCustom = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> iterable = [<span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>];</span><br><span class="line">iterable.foo = <span class="string">&#x27;hello&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>æ¯ä¸ªå¯¹è±¡å®ä¾‹éƒ½ä¼šç»§æ‰¿<code>objectCustom</code>å±æ€§ï¼Œå¹¶ä¸”æ¯ä¸ªArrayå¯¹è±¡çš„å®ä¾‹éƒ½ä¼šç»§æ‰¿<code>arrCustom</code>å±æ€§ï¼Œè¿™æ˜¯å› ä¸ºè¿™äº›å±æ€§å·²åˆ†åˆ«æ·»åŠ åˆ°<code>Onject.prototype</code>å’Œ<code>Array.prototype</code>ã€‚ç”±äºç»§æ‰¿å’ŒåŸå‹é“¾ï¼Œå¯è¿­ä»£å¯¹è±¡ç»§æ‰¿äº†å±æ€§<code>objCustom</code>å’Œ<code>arrCustom</code>ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> iterable) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i); <span class="comment">// logs 0, 1, 2, &quot;foo&quot;, &quot;arrCustom&quot;, &quot;objCustom&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå¾ªç¯åªä»¥ä»»æ„é¡ºåºæ‰“å°äº†å¯è¿­ä»£å¯¹è±¡çš„æšä¸¾å±æ€§ã€‚å®ƒä¸ä¼šæ‰“å°æ•°ç»„<strong>å…ƒç´ </strong><code>3</code>ï¼Œ<code>5</code>ï¼Œ<code>7</code>æˆ–è€…<code>hello</code>ï¼Œå› ä¸ºå®ƒä»¬ä¸æ˜¯å¯æšä¸¾å±æ€§ï¼Œ<strong>å®é™…ä¸Šå®ƒä»¬æ ¹æœ¬ä¸æ˜¯å±æ€§</strong>ï¼Œå®ƒä»¬æ˜¯å€¼ã€‚å®ƒæ‰€æ‰“å°çš„æ•°ç»„çš„ä¸‹æ ‡ï¼Œè¿˜æœ‰<code>arrCustom</code>å’Œ<code>objCustom</code>æ‰æ˜¯å±æ€§ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">in</span> iterable) &#123;</span><br><span class="line">  <span class="keyword">if</span> (iterable.hasOwnProperty(i)) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i); <span class="comment">// logs 0, 1, 2, &quot;foo&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå¾ªç¯å’Œä¸Šä¸€ä¸ªç›¸ä¼¼ï¼Œä½†å®ƒä½¿ç”¨<code>hasOwnProperty()</code>æ¥æ£€æŸ¥å¯æšä¸¾å±æ€§æ˜¯å¦æ˜¯å¯¹è±¡è‡ªèº«çš„ï¼Œä¸æ˜¯ç»§æ‰¿çš„ã€‚å¦‚æœæ˜¯ï¼Œåˆ™æ‰“å°è¯¥å±æ€§ã€‚å±æ€§<code>0</code>ï¼Œ<code>1</code>ï¼Œ<code>2</code>å’Œ<code>foo</code>è¢«è¾“å‡ºï¼Œå› ä¸ºä»–ä»¬æ˜¯è‡ªæœ‰å±æ€§(ä¸æ˜¯ç»§æ‰¿çš„)ã€‚å±æ€§<code>arrCustom</code>å’Œ<code>objCustom</code>æ²¡æœ‰è¢«è¾“å‡ºï¼Œå› ä¸ºä»–ä»¬æ˜¯ç»§æ‰¿çš„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> i <span class="keyword">of</span> iterable) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(i); <span class="comment">// logs 3, 5, 7</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå¾ªç¯è¿­ä»£å¹¶æ‰“å°äº†å¯è¿­ä»£çš„å€¼ï¼Œä½œä¸ºå¯è¿­ä»£å¯¹è±¡æ‰€å®šä¹‰çš„è¦è¿­ä»£çš„å€¼ã€‚å¯¹è±¡çš„å…ƒç´  3ã€5ã€7è¢«æ‰“å°ï¼Œä½†æ²¡æœ‰æ‰“å°å¯¹è±¡çš„ä»»ä½•å±æ€§ã€‚</p>
<p>è¡¥å……ï¼šJavaScriptè§„èŒƒå®šä¹‰çš„æ•°æ®å±æ€§[[Enumerable]]è¡¨ç¤ºå±æ€§æ˜¯å¦å¯ä»¥é€šè¿‡<code>for...in</code>å¾ªç¯è¿”å›ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰ç›´æ¥å®šä¹‰åœ¨å¯¹è±¡ä¸Šçš„å±æ€§çš„è¿™ä¸ªç‰¹æ€§éƒ½æ˜¯trueã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://hemengting.xyz/2021/09/10/for-of-%E4%B8%8E-for-in%E7%9A%84%E5%8C%BA%E5%88%AB/" data-id="ckuwtunho0002l4ubfp8qevie" data-title="for...of ä¸ for...inçš„åŒºåˆ«" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html-%E7%BF%BB%E8%AF%91/" rel="tag">html,ç¿»è¯‘</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/" rel="tag">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react-babel/" rel="tag">react babel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/" rel="tag">webpack</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/html-%E7%BF%BB%E8%AF%91/" style="font-size: 10px;">html,ç¿»è¯‘</a> <a href="/tags/react/" style="font-size: 10px;">react</a> <a href="/tags/react-babel/" style="font-size: 10px;">react babel</a> <a href="/tags/webpack/" style="font-size: 20px;">webpack</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/10/20/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAReact%E4%B8%8B/">ä»0å¼€å§‹å®ç°ä¸€ä¸ªReactä¸‹</a>
          </li>
        
          <li>
            <a href="/2021/10/17/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAReact/">ä»0å¼€å§‹å®ç°ä¸€ä¸ªReact</a>
          </li>
        
          <li>
            <a href="/2021/10/12/test/">test</a>
          </li>
        
          <li>
            <a href="/2021/09/23/%E7%BF%BB%E8%AF%91-viewports%E7%9A%84%E6%95%85%E4%BA%8B-part-one/">ç¿»è¯‘:viewportsçš„æ•…äº‹-ç¬¬ä¸€éƒ¨åˆ†</a>
          </li>
        
          <li>
            <a href="/2021/09/19/this%E6%98%AF%E4%BB%80%E4%B9%88/">thisæ˜¯ä»€ä¹ˆ</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 He Mengting<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>